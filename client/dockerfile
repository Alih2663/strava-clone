FROM node:20-alpine

ARG PUBLIC_IP
ARG RESEND_API_KEY

ENV REACT_APP_API_URL=https://${PUBLIC_IP}
ENV REACT_APP_CHAT_URL=https://${PUBLIC_IP}
ENV RESEND_API_KEY=${RESEND_API_KEY}
ENV NEXT_PUBLIC_API_URL=https://${PUBLIC_IP}
ENV NEXT_PUBLIC_CHAT_URL=https://${PUBLIC_IP}

WORKDIR /app
COPY package*.json ./
RUN npm install
COPY . .
RUN npm run build

ENV PORT=3001
EXPOSE 3001
CMD ["npm", "start"]