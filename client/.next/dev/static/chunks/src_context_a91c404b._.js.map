{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///home/lorenzo/Documents/Projects/strava-clone/client/src/context/AuthContext.tsx"],"sourcesContent":["'use client';\n\nimport { createContext, useState, useEffect, useContext, ReactNode } from 'react';\nimport api from '../utils/api';\nimport { useRouter } from 'next/navigation';\n\ninterface User {\n    _id: string;\n    username: string;\n    email: string;\n    avatar?: string;\n}\n\ninterface AuthContextType {\n    user: User | null;\n    login: (token: string, user: User) => void;\n    logout: () => void;\n    loading: boolean;\n}\n\nconst AuthContext = createContext<AuthContextType | undefined>(undefined);\n\nexport const AuthProvider = ({ children }: { children: ReactNode }) => {\n    const [user, setUser] = useState<User | null>(null);\n    const [loading, setLoading] = useState(true);\n    const router = useRouter();\n\n    useEffect(() => {\n        const token = localStorage.getItem('token');\n        const storedUser = localStorage.getItem('user');\n        if (token && storedUser) {\n            setUser(JSON.parse(storedUser));\n        }\n        setLoading(false);\n    }, []);\n\n    const login = (token: string, userData: User) => {\n        localStorage.setItem('token', token);\n        localStorage.setItem('user', JSON.stringify(userData));\n        setUser(userData);\n        router.push('/dashboard');\n    };\n\n    const logout = () => {\n        localStorage.removeItem('token');\n        localStorage.removeItem('user');\n        setUser(null);\n        router.push('/login');\n    };\n\n    return (\n        <AuthContext.Provider value={{ user, login, logout, loading }}>\n            {children}\n        </AuthContext.Provider>\n    );\n};\n\nexport const useAuth = () => {\n    const context = useContext(AuthContext);\n    if (!context) {\n        throw new Error('useAuth must be used within an AuthProvider');\n    }\n    return context;\n};\n"],"names":[],"mappings":";;;;;;;AAEA;AAEA;;;AAJA;;;AAoBA,MAAM,4BAAc,IAAA,8KAAa,EAA8B;AAExD,MAAM,eAAe,CAAC,EAAE,QAAQ,EAA2B;;IAC9D,MAAM,CAAC,MAAM,QAAQ,GAAG,IAAA,yKAAQ,EAAc;IAC9C,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,yKAAQ,EAAC;IACvC,MAAM,SAAS,IAAA,kJAAS;IAExB,IAAA,0KAAS;kCAAC;YACN,MAAM,QAAQ,aAAa,OAAO,CAAC;YACnC,MAAM,aAAa,aAAa,OAAO,CAAC;YACxC,IAAI,SAAS,YAAY;gBACrB,QAAQ,KAAK,KAAK,CAAC;YACvB;YACA,WAAW;QACf;iCAAG,EAAE;IAEL,MAAM,QAAQ,CAAC,OAAe;QAC1B,aAAa,OAAO,CAAC,SAAS;QAC9B,aAAa,OAAO,CAAC,QAAQ,KAAK,SAAS,CAAC;QAC5C,QAAQ;QACR,OAAO,IAAI,CAAC;IAChB;IAEA,MAAM,SAAS;QACX,aAAa,UAAU,CAAC;QACxB,aAAa,UAAU,CAAC;QACxB,QAAQ;QACR,OAAO,IAAI,CAAC;IAChB;IAEA,qBACI,6LAAC,YAAY,QAAQ;QAAC,OAAO;YAAE;YAAM;YAAO;YAAQ;QAAQ;kBACvD;;;;;;AAGb;GAjCa;;QAGM,kJAAS;;;KAHf;AAmCN,MAAM,UAAU;;IACnB,MAAM,UAAU,IAAA,2KAAU,EAAC;IAC3B,IAAI,CAAC,SAAS;QACV,MAAM,IAAI,MAAM;IACpB;IACA,OAAO;AACX;IANa"}},
    {"offset": {"line": 84, "column": 0}, "map": {"version":3,"sources":["file:///home/lorenzo/Documents/Projects/strava-clone/client/src/context/SocketContext.tsx"],"sourcesContent":["'use client';\n\nimport React, { createContext, useContext, useEffect, useState, ReactNode } from 'react';\nimport { io, Socket } from 'socket.io-client';\nimport { useAuth } from './AuthContext';\n\ninterface SocketContextType {\n    socket: Socket | null;\n}\n\nconst SocketContext = createContext<SocketContextType | undefined>(undefined);\n\nexport const SocketProvider = ({ children }: { children: ReactNode }) => {\n    const [socket, setSocket] = useState<Socket | null>(null);\n    const { user } = useAuth();\n\n    useEffect(() => {\n        if (user) {\n            const newSocket = io('http://localhost:5000');\n            setSocket(newSocket);\n\n            newSocket.emit('join', user._id);\n\n            return () => {\n                newSocket.disconnect();\n            };\n        } else {\n            if (socket) {\n                socket.disconnect();\n                setSocket(null);\n            }\n        }\n    }, [user]);\n\n    return (\n        <SocketContext.Provider value={{ socket }}>\n            {children}\n        </SocketContext.Provider>\n    );\n};\n\nexport const useSocket = () => {\n    const context = useContext(SocketContext);\n    if (context === undefined) {\n        throw new Error('useSocket must be used within a SocketProvider');\n    }\n    return context;\n};\n"],"names":[],"mappings":";;;;;;;AAEA;AACA;AACA;;;AAJA;;;;AAUA,MAAM,8BAAgB,IAAA,8KAAa,EAAgC;AAE5D,MAAM,iBAAiB,CAAC,EAAE,QAAQ,EAA2B;;IAChE,MAAM,CAAC,QAAQ,UAAU,GAAG,IAAA,yKAAQ,EAAgB;IACpD,MAAM,EAAE,IAAI,EAAE,GAAG,IAAA,4IAAO;IAExB,IAAA,0KAAS;oCAAC;YACN,IAAI,MAAM;gBACN,MAAM,YAAY,IAAA,wLAAE,EAAC;gBACrB,UAAU;gBAEV,UAAU,IAAI,CAAC,QAAQ,KAAK,GAAG;gBAE/B;gDAAO;wBACH,UAAU,UAAU;oBACxB;;YACJ,OAAO;gBACH,IAAI,QAAQ;oBACR,OAAO,UAAU;oBACjB,UAAU;gBACd;YACJ;QACJ;mCAAG;QAAC;KAAK;IAET,qBACI,6LAAC,cAAc,QAAQ;QAAC,OAAO;YAAE;QAAO;kBACnC;;;;;;AAGb;GA3Ba;;QAEQ,4IAAO;;;KAFf;AA6BN,MAAM,YAAY;;IACrB,MAAM,UAAU,IAAA,2KAAU,EAAC;IAC3B,IAAI,YAAY,WAAW;QACvB,MAAM,IAAI,MAAM;IACpB;IACA,OAAO;AACX;IANa"}},
    {"offset": {"line": 161, "column": 0}, "map": {"version":3,"sources":["file:///home/lorenzo/Documents/Projects/strava-clone/client/src/context/ChatContext.tsx"],"sourcesContent":["'use client';\n\nimport React, { createContext, useContext, useEffect, useState, ReactNode } from 'react';\nimport { io, Socket } from 'socket.io-client';\nimport axios, { AxiosInstance } from 'axios';\nimport { useAuth } from './AuthContext';\n\n// Types\nexport interface Message {\n    _id: string;\n    conversationId: string;\n    sender: string;\n    text: string;\n    createdAt: string;\n}\n\nexport interface Conversation {\n    _id: string;\n    participants: string[]; // User IDs (or populated objects if needed)\n    lastMessage?: Message;\n    updatedAt: string;\n    unreadCount?: number;\n}\n\ninterface ChatContextType {\n    socket: Socket | null;\n    chatApi: AxiosInstance;\n    isChatOpen: boolean;\n    toggleChat: () => void;\n    activeConversation: Conversation | null;\n    setActiveConversation: (conversation: Conversation | null) => void;\n    unreadCount: number;\n    setUnreadCount: React.Dispatch<React.SetStateAction<number>>;\n    markConversationAsRead: (conversationId: string) => Promise<void>;\n}\n\nconst ChatContext = createContext<ChatContextType | undefined>(undefined);\n\nexport const ChatProvider = ({ children }: { children: ReactNode }) => {\n    const { user } = useAuth();\n    const [socket, setSocket] = useState<Socket | null>(null);\n    const [isChatOpen, setIsChatOpen] = useState(false);\n    const [activeConversation, setActiveConversation] = useState<Conversation | null>(null);\n    const [unreadCount, setUnreadCount] = useState(0);\n\n    // Create a dedicated API instance for the chat server\n    const chatApi = axios.create({\n        baseURL: 'http://localhost:3000/api',\n        headers: {\n            'Content-Type': 'application/json',\n        },\n    });\n\n    // Add auth token to chat API requests\n    chatApi.interceptors.request.use((config) => {\n        const token = localStorage.getItem('token');\n        if (token) {\n            config.headers.Authorization = `Bearer ${token}`;\n        }\n        return config;\n    });\n\n    useEffect(() => {\n        if (user) {\n            const newSocket = io('http://localhost:3000', {\n                auth: {\n                    userId: user._id\n                }\n            });\n            setSocket(newSocket);\n\n            newSocket.on('connect', () => {\n                console.log('Connected to Chat Server');\n            });\n\n            newSocket.on('message_notification', () => {\n                setUnreadCount(prev => prev + 1);\n            });\n\n            return () => {\n                newSocket.disconnect();\n            };\n        } else {\n            if (socket) {\n                socket.disconnect();\n                setSocket(null);\n            }\n        }\n    }, [user]);\n\n    const toggleChat = () => {\n        setIsChatOpen(prev => !prev);\n        if (!isChatOpen) {\n            // Reset unread count when opening chat (optional logic, maybe strictly on specific conversation open)\n            // setUnreadCount(0); \n        }\n    };\n\n    const markConversationAsRead = async (conversationId: string) => {\n        try {\n            if (!user) return;\n            await chatApi.post(`/conversations/${conversationId}/read`, { userId: user._id });\n            // Ideally update local state too if we had it here\n        } catch (err) {\n            console.error(\"Failed to mark read\", err);\n        }\n    };\n\n    return (\n        <ChatContext.Provider value={{\n            socket,\n            chatApi,\n            isChatOpen,\n            toggleChat,\n            activeConversation,\n            setActiveConversation,\n            unreadCount,\n            setUnreadCount,\n            markConversationAsRead\n        }}>\n            {children}\n        </ChatContext.Provider>\n    );\n};\n\nexport const useChat = () => {\n    const context = useContext(ChatContext);\n    if (context === undefined) {\n        throw new Error('useChat must be used within a ChatProvider');\n    }\n    return context;\n};\n"],"names":[],"mappings":";;;;;;;AAEA;AACA;AACA;AACA;;;AALA;;;;;AAoCA,MAAM,4BAAc,IAAA,8KAAa,EAA8B;AAExD,MAAM,eAAe,CAAC,EAAE,QAAQ,EAA2B;;IAC9D,MAAM,EAAE,IAAI,EAAE,GAAG,IAAA,4IAAO;IACxB,MAAM,CAAC,QAAQ,UAAU,GAAG,IAAA,yKAAQ,EAAgB;IACpD,MAAM,CAAC,YAAY,cAAc,GAAG,IAAA,yKAAQ,EAAC;IAC7C,MAAM,CAAC,oBAAoB,sBAAsB,GAAG,IAAA,yKAAQ,EAAsB;IAClF,MAAM,CAAC,aAAa,eAAe,GAAG,IAAA,yKAAQ,EAAC;IAE/C,sDAAsD;IACtD,MAAM,UAAU,mJAAK,CAAC,MAAM,CAAC;QACzB,SAAS;QACT,SAAS;YACL,gBAAgB;QACpB;IACJ;IAEA,sCAAsC;IACtC,QAAQ,YAAY,CAAC,OAAO,CAAC,GAAG;4BAAC,CAAC;YAC9B,MAAM,QAAQ,aAAa,OAAO,CAAC;YACnC,IAAI,OAAO;gBACP,OAAO,OAAO,CAAC,aAAa,GAAG,CAAC,OAAO,EAAE,OAAO;YACpD;YACA,OAAO;QACX;;IAEA,IAAA,0KAAS;kCAAC;YACN,IAAI,MAAM;gBACN,MAAM,YAAY,IAAA,wLAAE,EAAC,yBAAyB;oBAC1C,MAAM;wBACF,QAAQ,KAAK,GAAG;oBACpB;gBACJ;gBACA,UAAU;gBAEV,UAAU,EAAE,CAAC;8CAAW;wBACpB,QAAQ,GAAG,CAAC;oBAChB;;gBAEA,UAAU,EAAE,CAAC;8CAAwB;wBACjC;sDAAe,CAAA,OAAQ,OAAO;;oBAClC;;gBAEA;8CAAO;wBACH,UAAU,UAAU;oBACxB;;YACJ,OAAO;gBACH,IAAI,QAAQ;oBACR,OAAO,UAAU;oBACjB,UAAU;gBACd;YACJ;QACJ;iCAAG;QAAC;KAAK;IAET,MAAM,aAAa;QACf,cAAc,CAAA,OAAQ,CAAC;QACvB,IAAI,CAAC,YAAY;QACb,sGAAsG;QACtG,sBAAsB;QAC1B;IACJ;IAEA,MAAM,yBAAyB,OAAO;QAClC,IAAI;YACA,IAAI,CAAC,MAAM;YACX,MAAM,QAAQ,IAAI,CAAC,CAAC,eAAe,EAAE,eAAe,KAAK,CAAC,EAAE;gBAAE,QAAQ,KAAK,GAAG;YAAC;QAC/E,mDAAmD;QACvD,EAAE,OAAO,KAAK;YACV,QAAQ,KAAK,CAAC,uBAAuB;QACzC;IACJ;IAEA,qBACI,6LAAC,YAAY,QAAQ;QAAC,OAAO;YACzB;YACA;YACA;YACA;YACA;YACA;YACA;YACA;YACA;QACJ;kBACK;;;;;;AAGb;GArFa;;QACQ,4IAAO;;;KADf;AAuFN,MAAM,UAAU;;IACnB,MAAM,UAAU,IAAA,2KAAU,EAAC;IAC3B,IAAI,YAAY,WAAW;QACvB,MAAM,IAAI,MAAM;IACpB;IACA,OAAO;AACX;IANa"}}]
}