{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///home/lorenzo/Documents/Projects/strava-clone/client/src/utils/api.ts"],"sourcesContent":["import axios from 'axios';\n\nconst api = axios.create({\n    baseURL: 'http://localhost:5000/api',\n    headers: {\n        'Content-Type': 'application/json',\n    },\n});\n\napi.interceptors.request.use(\n    (config) => {\n        const token = localStorage.getItem('token');\n        if (token) {\n            config.headers.Authorization = `Bearer ${token}`;\n        }\n        return config;\n    },\n    (error) => Promise.reject(error)\n);\n\nexport default api;\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,MAAM,mJAAK,CAAC,MAAM,CAAC;IACrB,SAAS;IACT,SAAS;QACL,gBAAgB;IACpB;AACJ;AAEA,IAAI,YAAY,CAAC,OAAO,CAAC,GAAG,CACxB,CAAC;IACG,MAAM,QAAQ,aAAa,OAAO,CAAC;IACnC,IAAI,OAAO;QACP,OAAO,OAAO,CAAC,aAAa,GAAG,CAAC,OAAO,EAAE,OAAO;IACpD;IACA,OAAO;AACX,GACA,CAAC,QAAU,QAAQ,MAAM,CAAC;uCAGf"}},
    {"offset": {"line": 31, "column": 0}, "map": {"version":3,"sources":["file:///home/lorenzo/Documents/Projects/strava-clone/client/src/components/Chat/ConversationList.tsx"],"sourcesContent":["'use client';\n\nimport { useChat, Conversation } from '@/context/ChatContext';\nimport { useAuth } from '@/context/AuthContext';\nimport { useEffect, useState } from 'react';\nimport { MessageSquarePlus } from 'lucide-react';\n\nexport default function ConversationList({ onNewChat }: { onNewChat: () => void }) {\n    const { chatApi } = useChat(); // Need user ID to filter participants (to show OTHER person's name)\n    const { setActiveConversation } = useChat();\n    const { user: authUser } = useAuth(); // Or get from UseChat if added there. Better to use AuthContext.\n    const [conversations, setConversations] = useState<Conversation[]>([]);\n    const [loading, setLoading] = useState(true);\n\n    useEffect(() => {\n        if (authUser) {\n            loadConversations();\n        }\n    }, [authUser]);\n\n    const loadConversations = async () => {\n        try {\n            setLoading(true);\n            const res = await chatApi.get(`/conversations/${authUser?._id}`);\n            setConversations(res.data);\n        } catch (err) {\n            console.error(\"Failed to load conversations\", err);\n        } finally {\n            setLoading(false);\n        }\n    };\n\n    const getOtherParticipantId = (conversation: Conversation) => {\n        return conversation.participants.find(p => p !== authUser?._id) || 'Unknown';\n    };\n\n    return (\n        <div className=\"flex flex-col h-full bg-white\">\n            <div className=\"p-3 border-b flex justify-between items-center bg-gray-50\">\n                <h3 className=\"font-semibold text-gray-700\">Messages</h3>\n                <button onClick={onNewChat} className=\"text-orange-600 hover:bg-orange-50 p-1 rounded\">\n                    <MessageSquarePlus size={20} />\n                </button>\n            </div>\n\n            <div className=\"flex-1 overflow-y-auto\">\n                {loading ? (\n                    <div className=\"p-4 text-center text-gray-400\">Loading...</div>\n                ) : conversations.length === 0 ? (\n                    <div className=\"p-4 text-center text-gray-400 text-sm\">\n                        No conversations yet.<br />Start a new chat!\n                    </div>\n                ) : (\n                    conversations.map(conv => (\n                        <div\n                            key={conv._id}\n                            onClick={() => setActiveConversation(conv)}\n                            className=\"p-3 border-b hover:bg-gray-50 cursor-pointer transition-colors\"\n                        >\n                            <div className=\"font-semibold text-sm text-gray-800\">\n                                User: {getOtherParticipantId(conv)}\n                                {/* Ideally fetch username or populate in backend */}\n                            </div>\n                            <div className=\"text-xs text-gray-500 truncate mt-1\">\n                                {conv.lastMessage?.text || 'No messages'}\n                            </div>\n                        </div>\n                    ))\n                )}\n            </div>\n        </div>\n    );\n}\n"],"names":[],"mappings":";;;;;AAEA;AACA;AACA;AACA;;;AALA;;;;;AAOe,SAAS,iBAAiB,EAAE,SAAS,EAA6B;;IAC7E,MAAM,EAAE,OAAO,EAAE,GAAG,IAAA,4IAAO,KAAI,oEAAoE;IACnG,MAAM,EAAE,qBAAqB,EAAE,GAAG,IAAA,4IAAO;IACzC,MAAM,EAAE,MAAM,QAAQ,EAAE,GAAG,IAAA,4IAAO,KAAI,iEAAiE;IACvG,MAAM,CAAC,eAAe,iBAAiB,GAAG,IAAA,yKAAQ,EAAiB,EAAE;IACrE,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,yKAAQ,EAAC;IAEvC,IAAA,0KAAS;sCAAC;YACN,IAAI,UAAU;gBACV;YACJ;QACJ;qCAAG;QAAC;KAAS;IAEb,MAAM,oBAAoB;QACtB,IAAI;YACA,WAAW;YACX,MAAM,MAAM,MAAM,QAAQ,GAAG,CAAC,CAAC,eAAe,EAAE,UAAU,KAAK;YAC/D,iBAAiB,IAAI,IAAI;QAC7B,EAAE,OAAO,KAAK;YACV,QAAQ,KAAK,CAAC,gCAAgC;QAClD,SAAU;YACN,WAAW;QACf;IACJ;IAEA,MAAM,wBAAwB,CAAC;QAC3B,OAAO,aAAa,YAAY,CAAC,IAAI,CAAC,CAAA,IAAK,MAAM,UAAU,QAAQ;IACvE;IAEA,qBACI,6LAAC;QAAI,WAAU;;0BACX,6LAAC;gBAAI,WAAU;;kCACX,6LAAC;wBAAG,WAAU;kCAA8B;;;;;;kCAC5C,6LAAC;wBAAO,SAAS;wBAAW,WAAU;kCAClC,cAAA,6LAAC,4PAAiB;4BAAC,MAAM;;;;;;;;;;;;;;;;;0BAIjC,6LAAC;gBAAI,WAAU;0BACV,wBACG,6LAAC;oBAAI,WAAU;8BAAgC;;;;;2BAC/C,cAAc,MAAM,KAAK,kBACzB,6LAAC;oBAAI,WAAU;;wBAAwC;sCAC9B,6LAAC;;;;;wBAAK;;;;;;2BAG/B,cAAc,GAAG,CAAC,CAAA,qBACd,6LAAC;wBAEG,SAAS,IAAM,sBAAsB;wBACrC,WAAU;;0CAEV,6LAAC;gCAAI,WAAU;;oCAAsC;oCAC1C,sBAAsB;;;;;;;0CAGjC,6LAAC;gCAAI,WAAU;0CACV,KAAK,WAAW,EAAE,QAAQ;;;;;;;uBAT1B,KAAK,GAAG;;;;;;;;;;;;;;;;AAiBzC;GAjEwB;;QACA,4IAAO;QACO,4IAAO;QACd,4IAAO;;;KAHd"}},
    {"offset": {"line": 194, "column": 0}, "map": {"version":3,"sources":["file:///home/lorenzo/Documents/Projects/strava-clone/client/src/components/Chat/ChatWindow.tsx"],"sourcesContent":["'use client';\n\nimport { useChat, Message } from '@/context/ChatContext';\nimport { useAuth } from '@/context/AuthContext';\nimport { useEffect, useState, useRef } from 'react';\nimport { ArrowLeft, Send } from 'lucide-react';\n\nexport default function ChatWindow() {\n    const { activeConversation, setActiveConversation, socket, chatApi } = useChat();\n    const { user } = useAuth();\n    const [messages, setMessages] = useState<Message[]>([]);\n    const [inputText, setInputText] = useState('');\n    const [sending, setSending] = useState(false);\n    const messagesEndRef = useRef<HTMLDivElement>(null);\n\n    useEffect(() => {\n        if (activeConversation) {\n            loadMessages();\n\n            // Join conversation room\n            socket?.emit('join_conversation', activeConversation._id);\n\n            // Listen for NEW messages\n            const handleReceiveMessage = (newMessage: Message) => {\n                // Verify it belongs to this conversation\n                if (newMessage.conversationId === activeConversation._id) {\n                    setMessages(prev => [...prev, newMessage]);\n                    scrollToBottom();\n                }\n            };\n\n            socket?.on('receive_message', handleReceiveMessage);\n\n            return () => {\n                socket?.emit('leave_conversation', activeConversation._id);\n                socket?.off('receive_message', handleReceiveMessage);\n            };\n        }\n    }, [activeConversation, socket]);\n\n    const loadMessages = async () => {\n        if (!activeConversation) return;\n        try {\n            const res = await chatApi.get(`/messages/${activeConversation._id}`);\n            setMessages(res.data); // Assuming API returns chronological order (oldest -> newest) or reverse it\n            scrollToBottom();\n        } catch (err) {\n            console.error(\"Failed to load messages\", err);\n        }\n    };\n\n    const scrollToBottom = () => {\n        setTimeout(() => {\n            messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });\n        }, 100);\n    };\n\n    const handleSend = async (e?: React.FormEvent) => {\n        e?.preventDefault();\n        if (!inputText.trim() || !activeConversation || !socket || sending) return;\n\n        setSending(true);\n        // Optimistic UI updates could be added here, but let's rely on server ack/echo for consistency first\n\n        socket.emit('send_message', {\n            conversationId: activeConversation._id,\n            text: inputText,\n            // recipientId is optional if conversationId exists\n        });\n\n        setInputText('');\n        setSending(false);\n        // The 'receive_message' event will update the UI\n    };\n\n    return (\n        <div className=\"flex flex-col h-full bg-white\">\n            <div className=\"p-3 border-b flex items-center gap-3 bg-gray-50 shadow-sm z-10\">\n                <button onClick={() => setActiveConversation(null)} className=\"text-gray-500 hover:bg-gray-200 p-1 rounded-full\">\n                    <ArrowLeft size={18} />\n                </button>\n                <div className=\"font-semibold text-gray-700\">\n                    Chat\n                    {/* Add participant name here */}\n                </div>\n            </div>\n\n            <div className=\"flex-1 overflow-y-auto p-4 space-y-3 bg-gray-100\">\n                {messages.map((msg, index) => {\n                    const isOwn = msg.sender === user?._id;\n                    return (\n                        <div key={index} className={`flex ${isOwn ? 'justify-end' : 'justify-start'}`}>\n                            <div className={`max-w-[75%] p-2 rounded-lg text-sm shadow-sm ${isOwn ? 'bg-orange-500 text-white rounded-br-none' : 'bg-white text-gray-800 border rounded-bl-none'}`}>\n                                {msg.text}\n                            </div>\n                        </div>\n                    );\n                })}\n                <div ref={messagesEndRef} />\n            </div>\n\n            <form onSubmit={handleSend} className=\"p-3 border-t bg-white flex gap-2\">\n                <input\n                    type=\"text\"\n                    value={inputText}\n                    onChange={(e) => setInputText(e.target.value)}\n                    placeholder=\"Type a message...\"\n                    className=\"flex-1 border rounded-full px-4 py-2 text-sm focus:outline-none focus:border-orange-500\"\n                />\n                <button\n                    type=\"submit\"\n                    disabled={!inputText.trim() || sending}\n                    className=\"bg-orange-600 text-white p-2 rounded-full hover:bg-orange-700 disabled:opacity-50 transition-colors\"\n                >\n                    <Send size={18} />\n                </button>\n            </form>\n        </div>\n    );\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 412, "column": 0}, "map": {"version":3,"sources":["file:///home/lorenzo/Documents/Projects/strava-clone/client/src/components/Chat/FriendSelector.tsx"],"sourcesContent":["export default function FriendSelector({ onSelect, onCancel }: { onSelect: (friendId: string) => void, onCancel: () => void }) {\n    // Mock friends for now or implement fetching\n    // Ideally this fetches from /api/users/friends (Main API)\n    // For this task, we will verify integration first.\n\n    // In a real implementation:\n    // const [friends, setFriends] = useState([]);\n    // useEffect(() => { api.get('/users/friends').then(...) }, []);\n\n    return (\n        <div className=\"flex flex-col h-full\">\n            <div className=\"p-3 border-b flex justify-between items-center bg-gray-50\">\n                <h3 className=\"font-semibold\">New Chat</h3>\n                <button onClick={onCancel} className=\"text-gray-500 hover:text-gray-700\">Cancel</button>\n            </div>\n            <div className=\"p-4 text-center text-gray-500\">\n                <p>Friend list integration pending...</p>\n                <p className=\"text-xs mt-2\">Enter a User ID to test:</p>\n                <input\n                    type=\"text\"\n                    className=\"border p-2 rounded w-full mt-2\"\n                    placeholder=\"User ID\"\n                    onKeyDown={(e) => {\n                        if (e.key === 'Enter') {\n                            onSelect((e.target as HTMLInputElement).value);\n                        }\n                    }}\n                />\n            </div>\n        </div>\n    );\n}\n"],"names":[],"mappings":";;;;;;AAAe,SAAS,eAAe,EAAE,QAAQ,EAAE,QAAQ,EAAkE;IACzH,6CAA6C;IAC7C,0DAA0D;IAC1D,mDAAmD;IAEnD,4BAA4B;IAC5B,8CAA8C;IAC9C,gEAAgE;IAEhE,qBACI,6LAAC;QAAI,WAAU;;0BACX,6LAAC;gBAAI,WAAU;;kCACX,6LAAC;wBAAG,WAAU;kCAAgB;;;;;;kCAC9B,6LAAC;wBAAO,SAAS;wBAAU,WAAU;kCAAoC;;;;;;;;;;;;0BAE7E,6LAAC;gBAAI,WAAU;;kCACX,6LAAC;kCAAE;;;;;;kCACH,6LAAC;wBAAE,WAAU;kCAAe;;;;;;kCAC5B,6LAAC;wBACG,MAAK;wBACL,WAAU;wBACV,aAAY;wBACZ,WAAW,CAAC;4BACR,IAAI,EAAE,GAAG,KAAK,SAAS;gCACnB,SAAS,AAAC,EAAE,MAAM,CAAsB,KAAK;4BACjD;wBACJ;;;;;;;;;;;;;;;;;;AAKpB;KA/BwB"}},
    {"offset": {"line": 509, "column": 0}, "map": {"version":3,"sources":["file:///home/lorenzo/Documents/Projects/strava-clone/client/src/components/Chat/ChatWidget.tsx"],"sourcesContent":["'use client';\n\nimport { useChat } from '@/context/ChatContext';\nimport { useState } from 'react';\nimport { X } from 'lucide-react';\nimport ConversationList from './ConversationList';\nimport ChatWindow from './ChatWindow';\nimport FriendSelector from './FriendSelector';\n\nexport default function ChatWidget() {\n    const { isChatOpen, toggleChat, activeConversation, socket, setActiveConversation } = useChat();\n    const [view, setView] = useState<'list' | 'new-chat'>('list');\n\n    if (!isChatOpen) return null;\n\n    const handleNewChat = () => {\n        setView('new-chat');\n    };\n\n    const handleFriendSelect = (friendId: string) => {\n        // Create or get conversation logic\n        // Ideally we check if conversation exists, OR we just start the chat window with a \"New\" state\n        // For simplicity, let's try to \"start\" it via socket immediately or just open the window \n        // and let the first message create the conversation if ID is missing.\n\n        // Emitting 'send_message' with recipientId creates it server-side.\n        // But ChatWindow expects an activeConversation object.\n\n        // Let's fake a temporary conversation object or fetch it.\n        // Better strategy: Use socket to 'join' or 'get' conversation.\n        // For this MVP step:\n\n        console.log(\"Selected friend:\", friendId);\n        // Trigger a socket event to find/create conversation? \n        // Or just pass a dummy conversation object with NO _id but with participants, handle that in ChatWindow?\n        // Simpler: Just rely on sending valid recipientId.\n\n        // Let's assume the user enters an ID (per FriendSelector stub).\n        // Check if we want to support starting chat.\n\n        // Hack for MVP:\n        // Attempt to find conversation client-side? No.\n\n        // Let's just switch back to list for now as a placeholder action\n        setView('list');\n    };\n\n    return (\n        <div className=\"fixed bottom-24 right-8 w-80 h-96 bg-white rounded-lg shadow-2xl border border-gray-200 flex flex-col overflow-hidden z-[60] font-sans\">\n            {/* Header */}\n            <div className=\"bg-orange-600 text-white p-3 flex justify-between items-center shadow-md\">\n                <span className=\"font-bold\">Strava Chat</span>\n                <button onClick={toggleChat} className=\"hover:bg-orange-700 p-1 rounded\">\n                    <X size={18} />\n                </button>\n            </div>\n\n            {/* Content area */}\n            <div className=\"flex-1 overflow-hidden relative\">\n                {activeConversation ? (\n                    <ChatWindow />\n                ) : view === 'new-chat' ? (\n                    <FriendSelector\n                        onSelect={handleFriendSelect}\n                        onCancel={() => setView('list')}\n                    />\n                ) : (\n                    <ConversationList onNewChat={handleNewChat} />\n                )}\n            </div>\n        </div>\n    );\n}\n"],"names":[],"mappings":";;;;;AAEA;AACA;AACA;AACA;AACA;AACA;;;AAPA;;;;;;;AASe,SAAS;;IACpB,MAAM,EAAE,UAAU,EAAE,UAAU,EAAE,kBAAkB,EAAE,MAAM,EAAE,qBAAqB,EAAE,GAAG,IAAA,4IAAO;IAC7F,MAAM,CAAC,MAAM,QAAQ,GAAG,IAAA,yKAAQ,EAAsB;IAEtD,IAAI,CAAC,YAAY,OAAO;IAExB,MAAM,gBAAgB;QAClB,QAAQ;IACZ;IAEA,MAAM,qBAAqB,CAAC;QACxB,mCAAmC;QACnC,+FAA+F;QAC/F,0FAA0F;QAC1F,sEAAsE;QAEtE,mEAAmE;QACnE,uDAAuD;QAEvD,0DAA0D;QAC1D,+DAA+D;QAC/D,qBAAqB;QAErB,QAAQ,GAAG,CAAC,oBAAoB;QAChC,uDAAuD;QACvD,yGAAyG;QACzG,mDAAmD;QAEnD,gEAAgE;QAChE,6CAA6C;QAE7C,gBAAgB;QAChB,gDAAgD;QAEhD,iEAAiE;QACjE,QAAQ;IACZ;IAEA,qBACI,6LAAC;QAAI,WAAU;;0BAEX,6LAAC;gBAAI,WAAU;;kCACX,6LAAC;wBAAK,WAAU;kCAAY;;;;;;kCAC5B,6LAAC;wBAAO,SAAS;wBAAY,WAAU;kCACnC,cAAA,6LAAC,oMAAC;4BAAC,MAAM;;;;;;;;;;;;;;;;;0BAKjB,6LAAC;gBAAI,WAAU;0BACV,mCACG,6LAAC,sJAAU;;;;2BACX,SAAS,2BACT,6LAAC,0JAAc;oBACX,UAAU;oBACV,UAAU,IAAM,QAAQ;;;;;yCAG5B,6LAAC,4JAAgB;oBAAC,WAAW;;;;;;;;;;;;;;;;;AAKjD;GA/DwB;;QACkE,4IAAO;;;KADzE"}},
    {"offset": {"line": 640, "column": 0}, "map": {"version":3,"sources":["file:///home/lorenzo/Documents/Projects/strava-clone/client/src/components/Navbar.tsx"],"sourcesContent":["'use client';\n\nimport Link from 'next/link';\nimport { useAuth } from '@/context/AuthContext';\nimport { useSocket } from '@/context/SocketContext';\nimport { LogOut, Upload, User, Bell, MessageCircle } from 'lucide-react';\nimport { useEffect, useState, useRef } from 'react';\nimport api from '@/utils/api';\nimport { usePathname } from 'next/navigation';\nimport ChatWidget from './Chat/ChatWidget';\nimport { useChat } from '@/context/ChatContext';\n\ninterface Notification {\n    _id: string;\n    sender: {\n        _id: string;\n        username: string;\n        profilePicture?: string;\n    };\n    type: 'comment' | 'reply' | 'like';\n    activity: {\n        _id: string;\n        title: string;\n    };\n    read: boolean;\n    createdAt: string;\n}\n\nexport default function Navbar() {\n    const { user, logout } = useAuth();\n    const { unreadCount: chatUnreadCount, toggleChat } = useChat();\n    const pathname = usePathname();\n    const [requestCount, setRequestCount] = useState(0);\n    const [notifications, setNotifications] = useState<Notification[]>([]);\n    const [unreadCount, setUnreadCount] = useState(0);\n    const [showNotifications, setShowNotifications] = useState(false);\n    const [animateBadge, setAnimateBadge] = useState(false);\n    const dropdownRef = useRef<HTMLDivElement>(null);\n\n    const { socket } = useSocket();\n\n    useEffect(() => {\n        if (user) {\n            fetchData();\n        }\n    }, [user]);\n\n    useEffect(() => {\n        if (socket) {\n            socket.on('notification', (newNotification: Notification) => {\n                setNotifications(prev => [newNotification, ...prev]);\n                setUnreadCount(prev => prev + 1);\n                setAnimateBadge(true);\n                setTimeout(() => setAnimateBadge(false), 1000);\n            });\n\n            socket.on('friend_request', () => {\n                setRequestCount(prev => prev + 1);\n            });\n\n            return () => {\n                socket.off('notification');\n                socket.off('friend_request');\n            };\n        }\n    }, [socket]);\n\n    // Close dropdown when clicking outside\n    useEffect(() => {\n        function handleClickOutside(event: MouseEvent) {\n            if (dropdownRef.current && !dropdownRef.current.contains(event.target as Node)) {\n                setShowNotifications(false);\n            }\n        }\n        document.addEventListener(\"mousedown\", handleClickOutside);\n        return () => document.removeEventListener(\"mousedown\", handleClickOutside);\n    }, []);\n\n    const fetchData = async () => {\n        try {\n            const [requestsRes, notifRes] = await Promise.all([\n                api.get('/users/friend-requests'),\n                api.get('/notifications')\n            ]);\n            setRequestCount(requestsRes.data.length);\n\n            const newUnreadCount = notifRes.data.unreadCount;\n            if (newUnreadCount > unreadCount) {\n                setAnimateBadge(true);\n                setTimeout(() => setAnimateBadge(false), 1000); // Reset animation\n            }\n            setUnreadCount(newUnreadCount);\n            setNotifications(notifRes.data.notifications);\n        } catch (err) {\n            console.error(err);\n        }\n    };\n\n    const handleNotificationClick = () => {\n        setShowNotifications(!showNotifications);\n    };\n\n    const handleMarkAllRead = async () => {\n        try {\n            await api.put('/notifications/read');\n            setUnreadCount(0);\n            setNotifications([]);\n        } catch (err) {\n            console.error(err);\n        }\n    };\n\n    const handleSingleRead = async (id: string, isRead: boolean) => {\n        setShowNotifications(false);\n        if (!isRead) {\n            try {\n                await api.put(`/notifications/${id}/read`);\n                setUnreadCount(prev => Math.max(0, prev - 1));\n                setNotifications(prev => prev.filter(n => n._id !== id));\n            } catch (err) {\n                console.error(err);\n            }\n        }\n    };\n\n    return (\n        <nav className=\"bg-orange-600 text-white p-4 shadow-md relative z-50\">\n            <div className=\"container mx-auto flex justify-between items-center\">\n                <Link href=\"/dashboard\" className=\"text-xl font-bold flex items-center gap-2\">\n                    <img src=\"/logo.png\" alt=\"Logo\" className=\"w-8 h-8\" /> StravaClone\n                </Link>\n                <div className=\"flex items-center gap-6\">\n                    {user ? (\n                        <>\n                            {/* Chat Icon */}\n                            <button\n                                onClick={toggleChat}\n                                className=\"relative hover:text-orange-200 flex items-center\"\n                            >\n                                <MessageCircle size={20} />\n                                {chatUnreadCount > 0 && (\n                                    <span className=\"absolute -top-2 -right-2 bg-red-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center\">\n                                        {chatUnreadCount}\n                                    </span>\n                                )}\n                            </button>\n\n                            {/* Notifications Dropdown */}\n                            <div className=\"relative\" ref={dropdownRef}>\n                                <button\n                                    onClick={handleNotificationClick}\n                                    className=\"relative hover:text-orange-200 flex items-center\"\n                                >\n                                    <Bell size={20} />\n                                    {unreadCount > 0 && (\n                                        <span className={`absolute -top-2 -right-2 bg-red-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center ${animateBadge ? 'animate-bounce' : ''}`}>\n                                            {unreadCount}\n                                        </span>\n                                    )}\n                                </button>\n\n                                {showNotifications && (\n                                    <div className=\"absolute right-0 mt-2 w-80 bg-white text-gray-800 rounded-lg shadow-xl border border-gray-200 overflow-hidden\">\n                                        <div className=\"p-3 border-b bg-gray-50 font-semibold flex justify-between items-center\">\n                                            <span>Notifications</span>\n                                            {unreadCount > 0 && (\n                                                <button\n                                                    onClick={handleMarkAllRead}\n                                                    className=\"text-xs text-orange-600 hover:text-orange-800 font-normal\"\n                                                >\n                                                    Mark all read\n                                                </button>\n                                            )}\n                                        </div>\n                                        <div className=\"max-h-96 overflow-y-auto\">\n                                            {notifications.length === 0 ? (\n                                                <div className=\"p-4 text-center text-gray-500 text-sm\">No notifications</div>\n                                            ) : (\n                                                notifications.map(notif => (\n                                                    <div\n                                                        key={notif._id}\n                                                        className={`block p-3 hover:bg-gray-50 border-b last:border-b-0 text-sm ${!notif.read ? 'bg-orange-50 border-l-4 border-l-orange-500' : ''}`}\n                                                    >\n                                                        <Link\n                                                            href={`/profile/${notif.sender._id}`}\n                                                            className=\"font-semibold hover:underline hover:text-orange-600\"\n                                                            onClick={(e) => {\n                                                                e.stopPropagation();\n                                                                setShowNotifications(false);\n                                                            }}\n                                                        >\n                                                            {notif.sender.username}\n                                                        </Link>\n                                                        {' '}\n                                                        <Link\n                                                            href={`/activity/${notif.activity?._id}`}\n                                                            className=\"hover:underline\"\n                                                            onClick={() => handleSingleRead(notif._id, notif.read)}\n                                                        >\n                                                            {notif.type === 'like' ? 'liked' : (notif.type === 'comment' ? 'commented on' : 'replied to your comment on')}\n                                                            {' '}\n                                                            <span className=\"font-medium text-orange-600\">{notif.activity?.title || 'an activity'}</span>\n                                                        </Link>\n                                                    </div>\n                                                ))\n                                            )}\n                                        </div>\n                                    </div>\n                                )}\n                            </div>\n\n                            <Link href=\"/search\" className=\"hover:text-orange-200\">Find Friends</Link>\n                            <Link href=\"/friends\" className=\"hover:text-orange-200 relative\">\n                                Requests\n                                {requestCount > 0 && (\n                                    <span className=\"absolute -top-2 -right-3 bg-red-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center\">\n                                        {requestCount}\n                                    </span>\n                                )}\n                            </Link>\n\n                            <Link href={`/profile/${user._id}`} className=\"flex items-center gap-2 hover:text-orange-200\">\n                                <User size={20} />\n                                <span>{user.username}</span>\n                            </Link>\n                            <button onClick={logout} className=\"flex items-center gap-1 hover:text-orange-200\">\n                                <LogOut size={20} /> Logout\n                            </button>\n                        </>\n                    ) : (\n                        <Link href=\"/login\" className=\"hover:text-orange-200\">Login</Link>\n                    )}\n                </div>\n            </div>\n\n            {/* Floating Upload Button */}\n            {user && pathname !== '/upload' && (\n                <Link\n                    href=\"/upload\"\n                    className=\"fixed bottom-8 left-1/2 transform -translate-x-1/2 bg-orange-600 text-white p-4 rounded-full shadow-lg hover:bg-orange-700 transition-colors z-50 flex items-center gap-2\"\n                >\n                    <Upload size={24} />\n                    <span className=\"font-bold\">Upload Activity</span>\n                </Link>\n            )}\n\n            <ChatWidget />\n        </nav>\n    );\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1113, "column": 0}, "map": {"version":3,"sources":["file:///home/lorenzo/Documents/Projects/strava-clone/client/src/components/ActivityCard.tsx"],"sourcesContent":["import Link from 'next/link';\nimport { Activity as ActivityIcon } from 'lucide-react';\n\ninterface Activity {\n    _id: string;\n    title: string;\n    description: string;\n    sportType: string;\n    stats: {\n        distance: number;\n        duration: number;\n        elevationGain: number;\n    };\n    user: {\n        _id: string;\n        username: string;\n        avatar?: string;\n    };\n    createdAt: string;\n}\n\ninterface ActivityCardProps {\n    activity: Activity;\n}\n\nexport default function ActivityCard({ activity }: ActivityCardProps) {\n    const formatDuration = (seconds: number) => {\n        const h = Math.floor(seconds / 3600);\n        const m = Math.floor((seconds % 3600) / 60);\n        const s = seconds % 60;\n        return `${h}h ${m}m ${s}s`;\n    };\n\n    return (\n        <div className=\"bg-white p-6 rounded-lg shadow-md\">\n            <div className=\"flex items-center gap-3 mb-4\">\n                <Link href={`/profile/${activity.user._id}`}>\n                    <div className=\"w-10 h-10 bg-gray-300 rounded-full flex items-center justify-center overflow-hidden hover:opacity-80 transition-opacity\">\n                        {activity.user.avatar ? (\n                            <img src={activity.user.avatar} alt={activity.user.username} className=\"w-full h-full object-cover\" />\n                        ) : (\n                            <span className=\"text-gray-600 font-semibold\">{activity.user.username[0].toUpperCase()}</span>\n                        )}\n                    </div>\n                </Link>\n                <div>\n                    <Link href={`/profile/${activity.user._id}`} className=\"font-semibold hover:text-orange-600 hover:underline\">\n                        {activity.user.username}\n                    </Link>\n                    <p className=\"text-xs text-gray-500\">{new Date(activity.createdAt).toLocaleString()}</p>\n                </div>\n            </div>\n            <Link href={`/activity/${activity._id}`} className=\"hover:text-orange-600\">\n                <h2 className=\"text-xl font-bold mb-2\">{activity.title}</h2>\n            </Link>\n            <p className=\"text-gray-600 mb-4\">{activity.description}</p>\n            <div className=\"grid grid-cols-3 gap-4 text-sm\">\n                <div className=\"flex flex-col\">\n                    <span className=\"text-gray-500\">Distance</span>\n                    <span className=\"font-semibold\">{(activity.stats.distance / 1000).toFixed(2)} km</span>\n                </div>\n                <div className=\"flex flex-col\">\n                    <span className=\"text-gray-500\">Duration</span>\n                    <span className=\"font-semibold\">{formatDuration(activity.stats.duration)}</span>\n                </div>\n                <div className=\"flex flex-col\">\n                    <span className=\"text-gray-500\">Elevation</span>\n                    <span className=\"font-semibold\">{activity.stats.elevationGain} m</span>\n                </div>\n            </div>\n            <div className=\"mt-4 pt-4 border-t flex gap-4 text-gray-500\">\n                <div className=\"flex items-center gap-1\"><ActivityIcon size={16} /> {activity.sportType}</div>\n            </div>\n        </div>\n    );\n}\n"],"names":[],"mappings":";;;;;AAAA;AACA;;;;AAwBe,SAAS,aAAa,EAAE,QAAQ,EAAqB;IAChE,MAAM,iBAAiB,CAAC;QACpB,MAAM,IAAI,KAAK,KAAK,CAAC,UAAU;QAC/B,MAAM,IAAI,KAAK,KAAK,CAAC,AAAC,UAAU,OAAQ;QACxC,MAAM,IAAI,UAAU;QACpB,OAAO,GAAG,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,CAAC,CAAC;IAC9B;IAEA,qBACI,6LAAC;QAAI,WAAU;;0BACX,6LAAC;gBAAI,WAAU;;kCACX,6LAAC,0KAAI;wBAAC,MAAM,CAAC,SAAS,EAAE,SAAS,IAAI,CAAC,GAAG,EAAE;kCACvC,cAAA,6LAAC;4BAAI,WAAU;sCACV,SAAS,IAAI,CAAC,MAAM,iBACjB,6LAAC;gCAAI,KAAK,SAAS,IAAI,CAAC,MAAM;gCAAE,KAAK,SAAS,IAAI,CAAC,QAAQ;gCAAE,WAAU;;;;;qDAEvE,6LAAC;gCAAK,WAAU;0CAA+B,SAAS,IAAI,CAAC,QAAQ,CAAC,EAAE,CAAC,WAAW;;;;;;;;;;;;;;;;kCAIhG,6LAAC;;0CACG,6LAAC,0KAAI;gCAAC,MAAM,CAAC,SAAS,EAAE,SAAS,IAAI,CAAC,GAAG,EAAE;gCAAE,WAAU;0CAClD,SAAS,IAAI,CAAC,QAAQ;;;;;;0CAE3B,6LAAC;gCAAE,WAAU;0CAAyB,IAAI,KAAK,SAAS,SAAS,EAAE,cAAc;;;;;;;;;;;;;;;;;;0BAGzF,6LAAC,0KAAI;gBAAC,MAAM,CAAC,UAAU,EAAE,SAAS,GAAG,EAAE;gBAAE,WAAU;0BAC/C,cAAA,6LAAC;oBAAG,WAAU;8BAA0B,SAAS,KAAK;;;;;;;;;;;0BAE1D,6LAAC;gBAAE,WAAU;0BAAsB,SAAS,WAAW;;;;;;0BACvD,6LAAC;gBAAI,WAAU;;kCACX,6LAAC;wBAAI,WAAU;;0CACX,6LAAC;gCAAK,WAAU;0CAAgB;;;;;;0CAChC,6LAAC;gCAAK,WAAU;;oCAAiB,CAAC,SAAS,KAAK,CAAC,QAAQ,GAAG,IAAI,EAAE,OAAO,CAAC;oCAAG;;;;;;;;;;;;;kCAEjF,6LAAC;wBAAI,WAAU;;0CACX,6LAAC;gCAAK,WAAU;0CAAgB;;;;;;0CAChC,6LAAC;gCAAK,WAAU;0CAAiB,eAAe,SAAS,KAAK,CAAC,QAAQ;;;;;;;;;;;;kCAE3E,6LAAC;wBAAI,WAAU;;0CACX,6LAAC;gCAAK,WAAU;0CAAgB;;;;;;0CAChC,6LAAC;gCAAK,WAAU;;oCAAiB,SAAS,KAAK,CAAC,aAAa;oCAAC;;;;;;;;;;;;;;;;;;;0BAGtE,6LAAC;gBAAI,WAAU;0BACX,cAAA,6LAAC;oBAAI,WAAU;;sCAA0B,6LAAC,yNAAY;4BAAC,MAAM;;;;;;wBAAM;wBAAE,SAAS,SAAS;;;;;;;;;;;;;;;;;;AAIvG;KAlDwB"}},
    {"offset": {"line": 1353, "column": 0}, "map": {"version":3,"sources":["file:///home/lorenzo/Documents/Projects/strava-clone/client/src/app/profile/%5Bid%5D/page.tsx"],"sourcesContent":["'use client';\n\nimport { useEffect, useState } from 'react';\nimport api from '@/utils/api';\nimport Navbar from '@/components/Navbar';\nimport ActivityCard from '@/components/ActivityCard';\nimport { useParams } from 'next/navigation';\nimport { useAuth } from '@/context/AuthContext';\nimport { Edit2, Save, X } from 'lucide-react';\n\ninterface User {\n    _id: string;\n    username: string;\n    avatar?: string;\n    bio?: string;\n}\n\ninterface Activity {\n    _id: string;\n    title: string;\n    description: string;\n    sportType: string;\n    stats: {\n        distance: number;\n        duration: number;\n        elevationGain: number;\n    };\n    user: {\n        _id: string;\n        username: string;\n        avatar?: string;\n    };\n    createdAt: string;\n}\n\nexport default function ProfilePage() {\n    const { id } = useParams();\n    const { user: currentUser } = useAuth();\n    const [profileUser, setProfileUser] = useState<User | null>(null);\n    const [activities, setActivities] = useState<Activity[]>([]);\n    const [loading, setLoading] = useState(true);\n    const [isEditing, setIsEditing] = useState(false);\n    const [editBio, setEditBio] = useState('');\n    const [editAvatarFile, setEditAvatarFile] = useState<File | null>(null);\n\n    useEffect(() => {\n        const fetchProfileData = async () => {\n            try {\n                const [userRes, activitiesRes] = await Promise.all([\n                    api.get(`/users/${id}`),\n                    api.get(`/activities/user/${id}`)\n                ]);\n                setProfileUser(userRes.data);\n                setActivities(activitiesRes.data);\n                setEditBio(userRes.data.bio || '');\n                // setEditAvatar(userRes.data.avatar || ''); // No longer needed for file upload\n            } catch (error) {\n                console.error('Error fetching profile data:', error);\n            } finally {\n                setLoading(false);\n            }\n        };\n\n        if (id) fetchProfileData();\n    }, [id]);\n\n    const handleSaveProfile = async () => {\n        try {\n            const formData = new FormData();\n            formData.append('bio', editBio);\n            if (editAvatarFile) {\n                formData.append('avatar', editAvatarFile);\n            }\n\n            const { data } = await api.put('/users/profile', formData, {\n                headers: {\n                    'Content-Type': 'multipart/form-data'\n                }\n            });\n            setProfileUser(prev => prev ? { ...prev, bio: data.bio, avatar: data.avatar } : null);\n            setIsEditing(false);\n        } catch (error) {\n            console.error('Error updating profile:', error);\n            alert('Failed to update profile');\n        }\n    };\n\n    if (loading) return <div>Loading...</div>;\n    if (!profileUser) return <div>User not found</div>;\n\n    const isOwnProfile = currentUser && currentUser._id === profileUser._id;\n\n    return (\n        <div className=\"min-h-screen bg-gray-100\">\n            <Navbar />\n            <div className=\"container mx-auto p-4 max-w-5xl\">\n                <div className=\"flex flex-col md:flex-row gap-6 mt-6\">\n                    {/* Left Sidebar - User Profile */}\n                    <div className=\"md:w-1/3\">\n                        <div className=\"bg-white p-6 rounded-lg shadow-md flex flex-col items-center text-center sticky top-24\">\n                            <div className=\"w-32 h-32 bg-gray-200 rounded-full mb-4 overflow-hidden flex items-center justify-center relative group\">\n                                {profileUser.avatar ? (\n                                    <img src={profileUser.avatar} alt={profileUser.username} className=\"w-full h-full object-cover\" />\n                                ) : (\n                                    <span className=\"text-4xl text-gray-500 font-bold\">{profileUser.username[0].toUpperCase()}</span>\n                                )}\n                            </div>\n\n                            <h1 className=\"text-2xl font-bold mb-2\">{profileUser.username}</h1>\n\n                            {isEditing ? (\n                                <div className=\"w-full space-y-3 mb-4\">\n                                    <div className=\"text-left\">\n                                        <label className=\"block text-xs font-medium text-gray-700 mb-1\">Profile Picture</label>\n                                        <input\n                                            type=\"file\"\n                                            accept=\"image/*\"\n                                            onChange={(e) => setEditAvatarFile(e.target.files ? e.target.files[0] : null)}\n                                            className=\"w-full border p-2 rounded text-sm\"\n                                        />\n                                    </div>\n                                    <textarea\n                                        placeholder=\"Bio\"\n                                        value={editBio}\n                                        onChange={(e) => setEditBio(e.target.value)}\n                                        className=\"w-full border p-2 rounded text-sm\"\n                                        rows={3}\n                                    />\n                                    <div className=\"flex gap-2 justify-center\">\n                                        <button onClick={handleSaveProfile} className=\"bg-green-500 text-white px-3 py-1 rounded flex items-center gap-1 text-sm\">\n                                            <Save size={14} /> Save\n                                        </button>\n                                        <button onClick={() => setIsEditing(false)} className=\"bg-gray-500 text-white px-3 py-1 rounded flex items-center gap-1 text-sm\">\n                                            <X size={14} /> Cancel\n                                        </button>\n                                    </div>\n                                </div>\n                            ) : (\n                                <>\n                                    {profileUser.bio && <p className=\"text-gray-600 mb-4 italic\">\"{profileUser.bio}\"</p>}\n                                    {isOwnProfile && (\n                                        <button\n                                            onClick={() => setIsEditing(true)}\n                                            className=\"mb-4 text-orange-600 hover:text-orange-800 flex items-center gap-1 text-sm\"\n                                        >\n                                            <Edit2 size={14} /> Edit Profile\n                                        </button>\n                                    )}\n                                </>\n                            )}\n\n                            <div className=\"mt-4 w-full\">\n                                <div className=\"flex justify-around border-t pt-4\">\n                                    <div className=\"flex flex-col\">\n                                        <span className=\"font-bold text-xl\">{activities.length}</span>\n                                        <span className=\"text-xs text-gray-500 uppercase\">Activities</span>\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n\n                    {/* Right Content - Activities */}\n                    <div className=\"md:w-2/3\">\n                        <h2 className=\"text-xl font-bold mb-4\">Activities</h2>\n                        <div className=\"space-y-4\">\n                            {activities.length === 0 ? (\n                                <div className=\"bg-white p-8 rounded-lg shadow-md text-center text-gray-500\">\n                                    No activities yet.\n                                </div>\n                            ) : (\n                                activities.map(activity => (\n                                    <ActivityCard key={activity._id} activity={activity} />\n                                ))\n                            )}\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n    );\n}\n"],"names":[],"mappings":"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"}}]
}