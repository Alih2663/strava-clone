{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///home/lorenzo/Documents/Projects/strava-clone/client/src/utils/api.ts"],"sourcesContent":["import axios from 'axios';\n\nconst api = axios.create({\n    baseURL: 'http://localhost:5000/api',\n    headers: {\n        'Content-Type': 'application/json',\n    },\n});\n\napi.interceptors.request.use(\n    (config) => {\n        const token = localStorage.getItem('token');\n        if (token) {\n            config.headers.Authorization = `Bearer ${token}`;\n        }\n        return config;\n    },\n    (error) => Promise.reject(error)\n);\n\nexport default api;\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,MAAM,gJAAK,CAAC,MAAM,CAAC;IACrB,SAAS;IACT,SAAS;QACL,gBAAgB;IACpB;AACJ;AAEA,IAAI,YAAY,CAAC,OAAO,CAAC,GAAG,CACxB,CAAC;IACG,MAAM,QAAQ,aAAa,OAAO,CAAC;IACnC,IAAI,OAAO;QACP,OAAO,OAAO,CAAC,aAAa,GAAG,CAAC,OAAO,EAAE,OAAO;IACpD;IACA,OAAO;AACX,GACA,CAAC,QAAU,QAAQ,MAAM,CAAC;uCAGf"}},
    {"offset": {"line": 28, "column": 0}, "map": {"version":3,"sources":["file:///home/lorenzo/Documents/Projects/strava-clone/client/src/components/Chat/ConversationList.tsx"],"sourcesContent":["'use client';\n\nimport { useChat, Conversation } from '@/context/ChatContext';\nimport { useAuth } from '@/context/AuthContext';\nimport { useEffect, useState } from 'react';\nimport { MessageSquarePlus, Search } from 'lucide-react';\nimport api from '@/utils/api'; // Use main API for fetching friends\n\ninterface Friend {\n    _id: string;\n    username: string;\n    avatar?: string;\n}\n\nexport default function ConversationList() {\n    const { chatApi } = useChat();\n    const { setActiveConversation, setUnreadCount } = useChat();\n    const { user: authUser } = useAuth();\n    const [conversations, setConversations] = useState<Conversation[]>([]);\n    const [friends, setFriends] = useState<Friend[]>([]);\n    const [loading, setLoading] = useState(true);\n\n    const [searchTerm, setSearchTerm] = useState('');\n    const [searchResults, setSearchResults] = useState<{ type: 'conversation' | 'friend', data: any }[]>([]);\n\n    useEffect(() => {\n        if (authUser) {\n            loadData();\n        }\n    }, [authUser]);\n\n    useEffect(() => {\n        handleSearch();\n    }, [searchTerm, conversations, friends]);\n\n    const loadData = async () => {\n        try {\n            setLoading(true);\n            const [convRes, friendsRes] = await Promise.all([\n                chatApi.get(`/conversations/${authUser?._id}`),\n                api.get('/users/friends')\n            ]);\n            setConversations(convRes.data);\n            setFriends(friendsRes.data);\n\n            // Calculate and set global unread count\n            const totalUnread = convRes.data.reduce((acc: number, conv: any) => acc + (conv.unreadCount || 0), 0);\n            setUnreadCount(totalUnread);\n        } catch (err) {\n            console.error(\"Failed to load data\", err);\n        } finally {\n            setLoading(false);\n        }\n    };\n\n    const getOtherParticipantId = (conversation: Conversation) => {\n        return conversation.participants.find(p => p !== authUser?._id) || 'Unknown';\n    };\n\n    // Helper to get friend details from ID (for existing conversations)\n    const getParticipantDetails = (participantId: string) => {\n        return friends.find(f => f._id === participantId) || { username: 'User ' + participantId.substr(0, 5), _id: participantId };\n    };\n\n    const handleSearch = () => {\n        if (!searchTerm.trim()) {\n            setSearchResults([]);\n            return;\n        }\n\n        const lowerTerm = searchTerm.toLowerCase();\n        const results: { type: 'conversation' | 'friend', data: any }[] = [];\n\n        // 1. Search existing conversations (by friend's name)\n        conversations.forEach(conv => {\n            const otherId = getOtherParticipantId(conv);\n            const details = getParticipantDetails(otherId);\n            if (details.username.toLowerCase().includes(lowerTerm)) {\n                results.push({ type: 'conversation', data: { ...conv, friendDetails: details } });\n            }\n        });\n\n        // 2. Search friends (who don't have an open conversation showing in results yet? \n        // Or show them anyway to \"Start Chat\" which effectively opens the existing one)\n        // Let's just list friends that match.\n        friends.forEach(friend => {\n            if (friend.username.toLowerCase().includes(lowerTerm)) {\n                // Check if already in results (as a conversation) to avoid duplicates?\n                // Actually, if a conversation exists, clicking the friend should just open it.\n                // Let's deduce if conversation exists for this friend.\n                const existingConv = conversations.find(c => c.participants.includes(friend._id));\n\n                if (!existingConv) {\n                    results.push({ type: 'friend', data: friend });\n                } else {\n                    // If we didn't add the conversation already (maybe logic mismatch), ensure it's handled.\n                    // But simpler: If conversation exists, we already added it in step 1.\n                    // So we ONLY add friends here if they don't have a conversation.\n                    // Wait, what if the user deleted the conversation? (Not implemented).\n                }\n            }\n        });\n\n        setSearchResults(results);\n    };\n\n    const startChatWithFriend = async (friendId: string) => {\n        // Check if conversation already exists locally to be safe\n        const existing = conversations.find(c => c.participants.includes(friendId));\n        if (existing) {\n            setActiveConversation(existing);\n            return;\n        }\n\n        // We can't synchronously \"create\" it here without an API call if we want the full object immediately.\n        // But for better UX, we can just open an empty chat window shell?\n        // Or better: Use socket/api to Create OR Get conversation.\n        // Let's assume the user sends a message.\n        // BUT ChatWindow needs `activeConversation`.\n\n        // Let's optimistically set a \"temporary\" conversation object\n        const tempConv: Conversation = {\n            _id: 'temp_' + Date.now(), // ID that won't match DB yet\n            participants: [authUser?._id!, friendId],\n            updatedAt: new Date().toISOString()\n        };\n\n        // Wait! We should fetch/create it via API to be robust. \n        // We generally shouldn't rely on 'pending' state in ChatWindow for IDs.\n        // Let's try to 'get' it via Chat API first?\n        // Or better: The ChatWindow logic handles \"if message sent -> create\".\n        // But we need to pass a valid conversation ID to ChatWindow usually, OR valid participants.\n        // Since `activeConversation` is the state, let's use a flag or special helper?\n\n        // Simple robust solution:\n        // Use Chat API to \"Init Conversation\"\n        // POST /conversations { participantId: ... } -> returns conv\n        // But we didn't implement that in chat_server/index.js (only get by userId).\n\n        // Solution: Just set it as active. \n        // But wait, our ChatWindow relies on `_id` to join room. 'temp_' room won't work for receiving messages.\n        // So we MUST create it on server or have server endpoint.\n\n        // Since we can't change server easily right now (objective is \"Enhancing Chat UI\"), \n        // let's try the socket 'send_message' approach? \n        // No, we need to open the window BEFORE sending.\n\n        // Correct approach with current server code:\n        // Client emits 'join_conversation' with ID.\n        // Client emits 'send_message' with recipientId? (Supported in server/socket.js line 67).\n        // Yes! `if (recipientId) ... find or create`.\n\n        // So we can set `activeConversation` to a special object that has `recipientId` distinct from `_id`.\n        // I need to update ChatContext type or just hack it.\n        // Let's hack it: `_id` is empty string?\n\n        const friend = friends.find(f => f._id === friendId);\n\n        const tempConvWithRecipient = {\n            _id: '', // Empty ID signals \"New/Pending\"\n            participants: [authUser?._id!, friendId],\n            updatedAt: new Date().toISOString(),\n            // We attach a custom property for the UI to know who we are talking to\n            // But Typescript will yell.\n            // We can just rely on `participants`.\n        } as Conversation;\n\n        // We need to modify ChatWindow to handle `_id === ''`\n        // It should SKIP joining room (or join user room?).\n        // And when sending, send `recipientId`.\n\n        setActiveConversation(tempConvWithRecipient);\n    };\n\n    return (\n        <div className=\"flex flex-col h-full bg-white\">\n            <div className=\"p-3 border-b bg-gray-50 space-y-2\">\n                <div className=\"flex justify-between items-center\">\n                    <h3 className=\"font-semibold text-gray-700\">Messages</h3>\n                    {/* <button onClick={onNewChat} ... /> Removed New Chat button as per plan */}\n                </div>\n                {/* Search Bar */}\n                <div className=\"relative\">\n                    <Search className=\"absolute left-2 top-1/2 transform -translate-y-1/2 text-gray-400\" size={16} />\n                    <input\n                        type=\"text\"\n                        placeholder=\"Search friends...\"\n                        value={searchTerm}\n                        onChange={(e) => setSearchTerm(e.target.value)}\n                        className=\"w-full pl-8 pr-2 py-1 text-sm text-black border rounded-full focus:outline-none focus:border-orange-500\"\n                    />\n                </div>\n            </div>\n\n            <div className=\"flex-1 overflow-y-auto\">\n                {loading ? (\n                    <div className=\"p-4 text-center text-gray-400\">Loading...</div>\n                ) : searchTerm ? (\n                    // SEARCH RESULTS VIEW\n                    searchResults.length === 0 ? (\n                        <div className=\"p-4 text-center text-gray-500 text-sm\">\n                            No friends found matching \"{searchTerm}\"\n                        </div>\n                    ) : (\n                        searchResults.map((result, idx) => {\n                            if (result.type === 'conversation') {\n                                return (\n                                    <div\n                                        key={'conv-' + result.data._id}\n                                        onClick={() => setActiveConversation(result.data)}\n                                        className=\"p-3 border-b hover:bg-orange-50 cursor-pointer transition-colors bg-white\"\n                                    >\n                                        <div className=\"font-semibold text-sm text-gray-800\">\n                                            {result.data.friendDetails.username}\n                                        </div>\n                                        <div className=\"text-xs text-green-600 mt-1\">\n                                            Existing Conversation\n                                        </div>\n                                    </div>\n                                );\n                            } else {\n                                return (\n                                    <div\n                                        key={'friend-' + result.data._id}\n                                        onClick={() => startChatWithFriend(result.data._id)}\n                                        className=\"p-3 border-b hover:bg-orange-50 cursor-pointer transition-colors bg-white\"\n                                    >\n                                        <div className=\"font-semibold text-sm text-gray-800\">\n                                            {result.data.username}\n                                        </div>\n                                        <div className=\"text-xs text-blue-600 mt-1\">\n                                            Start New Chat\n                                        </div>\n                                    </div>\n                                );\n                            }\n                        })\n                    )\n                ) : (\n                    // NORMAL LIST VIEW\n                    conversations.length === 0 ? (\n                        <div className=\"p-4 text-center text-gray-400 text-sm\">\n                            No conversations yet.<br />Search for a friend to start chatting!\n                        </div>\n                    ) : (\n                        conversations.map(conv => {\n                            const otherId = getOtherParticipantId(conv);\n                            const details = getParticipantDetails(otherId);\n                            return (\n                                <div\n                                    key={conv._id}\n                                    onClick={() => setActiveConversation(conv)}\n                                    className=\"p-3 border-b hover:bg-gray-50 cursor-pointer transition-colors\"\n                                >\n                                    <div className=\"font-semibold text-sm text-gray-800\">\n                                        {details.username}\n                                    </div>\n                                    <div className=\"flex justify-between items-start\">\n                                        <div className=\"text-xs text-gray-500 truncate mt-1\">\n                                            {conv.lastMessage?.text || 'No messages'}\n                                        </div>\n                                        {conv.unreadCount && conv.unreadCount > 0 && (\n                                            <span className=\"bg-red-500 text-white text-[10px] rounded-full px-1.5 py-0.5 ml-2\">\n                                                {conv.unreadCount}\n                                            </span>\n                                        )}\n                                    </div>\n                                </div>\n                            );\n                        })\n                    )\n                )}\n            </div>\n        </div>\n    );\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 410, "column": 0}, "map": {"version":3,"sources":["file:///home/lorenzo/Documents/Projects/strava-clone/client/src/components/Chat/ChatWindow.tsx"],"sourcesContent":["'use client';\n\nimport { useChat, Message } from '@/context/ChatContext';\nimport { useAuth } from '@/context/AuthContext';\nimport { useEffect, useState, useRef } from 'react';\nimport { ArrowLeft, Send } from 'lucide-react';\n\nexport default function ChatWindow() {\n    const { activeConversation, setActiveConversation, socket, chatApi, markConversationAsRead } = useChat();\n    const { user } = useAuth();\n    const [messages, setMessages] = useState<Message[]>([]);\n    const [inputText, setInputText] = useState('');\n    const [sending, setSending] = useState(false);\n    const messagesEndRef = useRef<HTMLDivElement>(null);\n\n    useEffect(() => {\n        if (activeConversation && activeConversation._id) {\n            loadMessages();\n\n            // Join conversation room\n            socket?.emit('join_conversation', activeConversation._id);\n            markConversationAsRead(activeConversation._id);\n\n            // Listen for NEW messages\n            const handleReceiveMessage = (newMessage: Message) => {\n                // Verify it belongs to this conversation\n                if (newMessage.conversationId === activeConversation._id) {\n                    setMessages(prev => [...prev, newMessage]);\n                    scrollToBottom();\n                }\n            };\n\n            socket?.on('receive_message', handleReceiveMessage);\n\n            return () => {\n                socket?.emit('leave_conversation', activeConversation._id);\n                socket?.off('receive_message', handleReceiveMessage);\n            };\n        } else if (activeConversation && !activeConversation._id) {\n            // New pending chat, no messages yet\n            setMessages([]);\n        }\n    }, [activeConversation, socket]);\n\n    const loadMessages = async () => {\n        if (!activeConversation || !activeConversation._id) return;\n        try {\n            const res = await chatApi.get(`/messages/${activeConversation._id}`);\n            setMessages(res.data); // Assuming API returns chronological order (oldest -> newest) or reverse it\n            scrollToBottom();\n        } catch (err) {\n            console.error(\"Failed to load messages\", err);\n        }\n    };\n\n    const scrollToBottom = () => {\n        setTimeout(() => {\n            messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });\n        }, 100);\n    };\n\n    const handleSend = async (e?: React.FormEvent) => {\n        e?.preventDefault();\n        if (!inputText.trim() || !activeConversation || !socket || sending) return;\n\n        setSending(true);\n        // Optimistic UI updates could be added here, but let's rely on server ack/echo for consistency first\n\n        const payload: any = {\n            text: inputText,\n        };\n\n        if (activeConversation._id) {\n            payload.conversationId = activeConversation._id;\n        } else {\n            // Pending conversation, send to recipient to create it\n            // We assume participants[1] is the OTHER person. \n            // Better to find the one that is NOT me.\n            const recipientId = activeConversation.participants.find(p => p !== user?._id);\n            payload.recipientId = recipientId;\n        }\n\n        socket.emit('send_message', payload);\n\n        setInputText('');\n        setSending(false);\n        // The 'receive_message' event will update the UI\n    };\n\n    return (\n        <div className=\"flex flex-col h-full bg-white\">\n            <div className=\"p-3 border-b flex items-center gap-3 bg-gray-50 shadow-sm z-10\">\n                <button onClick={() => setActiveConversation(null)} className=\"text-gray-500 hover:bg-gray-200 p-1 rounded-full\">\n                    <ArrowLeft size={18} />\n                </button>\n                <div className=\"font-semibold text-black\">\n                    Chat\n                    {/* Add participant name here */}\n                </div>\n            </div>\n\n            <div className=\"flex-1 overflow-y-auto p-4 space-y-3 bg-gray-100\">\n                {messages.map((msg, index) => {\n                    const isOwn = msg.sender === user?._id;\n                    return (\n                        <div key={index} className={`flex ${isOwn ? 'justify-end' : 'justify-start'}`}>\n                            <div className={`max-w-[75%] p-2 rounded-lg text-sm shadow-sm ${isOwn ? 'bg-orange-500 text-black rounded-br-none' : 'bg-white text-black border rounded-bl-none'}`}>\n                                {msg.text}\n                            </div>\n                        </div>\n                    );\n                })}\n                <div ref={messagesEndRef} />\n            </div>\n\n            <form onSubmit={handleSend} className=\"p-3 border-t bg-white flex gap-2\">\n                <input\n                    type=\"text\"\n                    value={inputText}\n                    onChange={(e) => setInputText(e.target.value)}\n                    placeholder=\"Type a message...\"\n                    className=\"flex-1 border rounded-full px-4 py-2 text-sm text-black focus:outline-none focus:border-orange-500\"\n                />\n                <button\n                    type=\"submit\"\n                    disabled={!inputText.trim() || sending}\n                    className=\"bg-orange-600 text-white p-2 rounded-full hover:bg-orange-700 disabled:opacity-50 transition-colors\"\n                >\n                    <Send size={18} />\n                </button>\n            </form>\n        </div>\n    );\n}\n"],"names":[],"mappings":";;;;;AAEA;AACA;AACA;AACA;AAAA;AALA;;;;;;AAOe,SAAS;IACpB,MAAM,EAAE,kBAAkB,EAAE,qBAAqB,EAAE,MAAM,EAAE,OAAO,EAAE,sBAAsB,EAAE,GAAG,IAAA,yIAAO;IACtG,MAAM,EAAE,IAAI,EAAE,GAAG,IAAA,yIAAO;IACxB,MAAM,CAAC,UAAU,YAAY,GAAG,IAAA,iNAAQ,EAAY,EAAE;IACtD,MAAM,CAAC,WAAW,aAAa,GAAG,IAAA,iNAAQ,EAAC;IAC3C,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,iNAAQ,EAAC;IACvC,MAAM,iBAAiB,IAAA,+MAAM,EAAiB;IAE9C,IAAA,kNAAS,EAAC;QACN,IAAI,sBAAsB,mBAAmB,GAAG,EAAE;YAC9C;YAEA,yBAAyB;YACzB,QAAQ,KAAK,qBAAqB,mBAAmB,GAAG;YACxD,uBAAuB,mBAAmB,GAAG;YAE7C,0BAA0B;YAC1B,MAAM,uBAAuB,CAAC;gBAC1B,yCAAyC;gBACzC,IAAI,WAAW,cAAc,KAAK,mBAAmB,GAAG,EAAE;oBACtD,YAAY,CAAA,OAAQ;+BAAI;4BAAM;yBAAW;oBACzC;gBACJ;YACJ;YAEA,QAAQ,GAAG,mBAAmB;YAE9B,OAAO;gBACH,QAAQ,KAAK,sBAAsB,mBAAmB,GAAG;gBACzD,QAAQ,IAAI,mBAAmB;YACnC;QACJ,OAAO,IAAI,sBAAsB,CAAC,mBAAmB,GAAG,EAAE;YACtD,oCAAoC;YACpC,YAAY,EAAE;QAClB;IACJ,GAAG;QAAC;QAAoB;KAAO;IAE/B,MAAM,eAAe;QACjB,IAAI,CAAC,sBAAsB,CAAC,mBAAmB,GAAG,EAAE;QACpD,IAAI;YACA,MAAM,MAAM,MAAM,QAAQ,GAAG,CAAC,CAAC,UAAU,EAAE,mBAAmB,GAAG,EAAE;YACnE,YAAY,IAAI,IAAI,GAAG,4EAA4E;YACnG;QACJ,EAAE,OAAO,KAAK;YACV,QAAQ,KAAK,CAAC,2BAA2B;QAC7C;IACJ;IAEA,MAAM,iBAAiB;QACnB,WAAW;YACP,eAAe,OAAO,EAAE,eAAe;gBAAE,UAAU;YAAS;QAChE,GAAG;IACP;IAEA,MAAM,aAAa,OAAO;QACtB,GAAG;QACH,IAAI,CAAC,UAAU,IAAI,MAAM,CAAC,sBAAsB,CAAC,UAAU,SAAS;QAEpE,WAAW;QACX,qGAAqG;QAErG,MAAM,UAAe;YACjB,MAAM;QACV;QAEA,IAAI,mBAAmB,GAAG,EAAE;YACxB,QAAQ,cAAc,GAAG,mBAAmB,GAAG;QACnD,OAAO;YACH,uDAAuD;YACvD,kDAAkD;YAClD,yCAAyC;YACzC,MAAM,cAAc,mBAAmB,YAAY,CAAC,IAAI,CAAC,CAAA,IAAK,MAAM,MAAM;YAC1E,QAAQ,WAAW,GAAG;QAC1B;QAEA,OAAO,IAAI,CAAC,gBAAgB;QAE5B,aAAa;QACb,WAAW;IACX,iDAAiD;IACrD;IAEA,qBACI,8OAAC;QAAI,WAAU;;0BACX,8OAAC;gBAAI,WAAU;;kCACX,8OAAC;wBAAO,SAAS,IAAM,sBAAsB;wBAAO,WAAU;kCAC1D,cAAA,8OAAC,6NAAS;4BAAC,MAAM;;;;;;;;;;;kCAErB,8OAAC;wBAAI,WAAU;kCAA2B;;;;;;;;;;;;0BAM9C,8OAAC;gBAAI,WAAU;;oBACV,SAAS,GAAG,CAAC,CAAC,KAAK;wBAChB,MAAM,QAAQ,IAAI,MAAM,KAAK,MAAM;wBACnC,qBACI,8OAAC;4BAAgB,WAAW,CAAC,KAAK,EAAE,QAAQ,gBAAgB,iBAAiB;sCACzE,cAAA,8OAAC;gCAAI,WAAW,CAAC,6CAA6C,EAAE,QAAQ,6CAA6C,8CAA8C;0CAC9J,IAAI,IAAI;;;;;;2BAFP;;;;;oBAMlB;kCACA,8OAAC;wBAAI,KAAK;;;;;;;;;;;;0BAGd,8OAAC;gBAAK,UAAU;gBAAY,WAAU;;kCAClC,8OAAC;wBACG,MAAK;wBACL,OAAO;wBACP,UAAU,CAAC,IAAM,aAAa,EAAE,MAAM,CAAC,KAAK;wBAC5C,aAAY;wBACZ,WAAU;;;;;;kCAEd,8OAAC;wBACG,MAAK;wBACL,UAAU,CAAC,UAAU,IAAI,MAAM;wBAC/B,WAAU;kCAEV,cAAA,8OAAC,0MAAI;4BAAC,MAAM;;;;;;;;;;;;;;;;;;;;;;;AAKhC"}},
    {"offset": {"line": 619, "column": 0}, "map": {"version":3,"sources":["file:///home/lorenzo/Documents/Projects/strava-clone/client/src/components/Chat/ChatWidget.tsx"],"sourcesContent":["'use client';\n\nimport { useChat } from '@/context/ChatContext';\nimport { X } from 'lucide-react';\nimport ConversationList from './ConversationList';\nimport ChatWindow from './ChatWindow';\n\nexport default function ChatWidget() {\n    const { isChatOpen, toggleChat, activeConversation, socket, setActiveConversation } = useChat();\n\n    if (!isChatOpen) return null;\n\n    return (\n        <div className={`fixed z-[60] font-sans flex flex-col overflow-hidden bg-white shadow-2xl border border-gray-200\n            ${isChatOpen ? 'bottom-0 right-0 w-full h-full md:bottom-24 md:right-8 md:w-80 md:h-96 md:rounded-lg' : 'hidden'}\n        `}>\n            {/* Header */}\n            <div className=\"bg-orange-600 text-white p-3 flex justify-between items-center shadow-md\">\n                <span className=\"font-bold\">Strava Chat</span>\n                <button onClick={toggleChat} className=\"hover:bg-orange-700 p-1 rounded\">\n                    <X size={18} />\n                </button>\n            </div>\n\n            {/* Content area */}\n            <div className=\"flex-1 overflow-hidden relative\">\n                {activeConversation ? (\n                    <ChatWindow />\n                ) : (\n                    <ConversationList />\n                )}\n            </div>\n        </div>\n    );\n}\n"],"names":[],"mappings":";;;;;AAEA;AACA;AACA;AACA;AALA;;;;;;AAOe,SAAS;IACpB,MAAM,EAAE,UAAU,EAAE,UAAU,EAAE,kBAAkB,EAAE,MAAM,EAAE,qBAAqB,EAAE,GAAG,IAAA,yIAAO;IAE7F,IAAI,CAAC,YAAY,OAAO;IAExB,qBACI,8OAAC;QAAI,WAAW,CAAC;YACb,EAAE,aAAa,yFAAyF,SAAS;QACrH,CAAC;;0BAEG,8OAAC;gBAAI,WAAU;;kCACX,8OAAC;wBAAK,WAAU;kCAAY;;;;;;kCAC5B,8OAAC;wBAAO,SAAS;wBAAY,WAAU;kCACnC,cAAA,8OAAC,iMAAC;4BAAC,MAAM;;;;;;;;;;;;;;;;;0BAKjB,8OAAC;gBAAI,WAAU;0BACV,mCACG,8OAAC,mJAAU;;;;yCAEX,8OAAC,yJAAgB;;;;;;;;;;;;;;;;AAKrC"}},
    {"offset": {"line": 701, "column": 0}, "map": {"version":3,"sources":["file:///home/lorenzo/Documents/Projects/strava-clone/client/src/components/Navbar.tsx"],"sourcesContent":["'use client';\n\nimport Link from 'next/link';\nimport { useAuth } from '@/context/AuthContext';\nimport { useSocket } from '@/context/SocketContext';\nimport { LogOut, Upload, User, Bell, MessageCircle } from 'lucide-react';\nimport { useEffect, useState, useRef } from 'react';\nimport api from '@/utils/api';\nimport { usePathname } from 'next/navigation';\nimport ChatWidget from './Chat/ChatWidget';\nimport { useChat } from '@/context/ChatContext';\n\ninterface Notification {\n    _id: string;\n    sender: {\n        _id: string;\n        username: string;\n        profilePicture?: string;\n    };\n    type: 'comment' | 'reply' | 'like';\n    activity: {\n        _id: string;\n        title: string;\n    };\n    read: boolean;\n    createdAt: string;\n}\n\nexport default function Navbar() {\n    const { user, logout } = useAuth();\n    const { unreadCount: chatUnreadCount, toggleChat } = useChat();\n    const pathname = usePathname();\n    const [requestCount, setRequestCount] = useState(0);\n    const [notifications, setNotifications] = useState<Notification[]>([]);\n    const [unreadCount, setUnreadCount] = useState(0);\n    const [showNotifications, setShowNotifications] = useState(false);\n    const [animateBadge, setAnimateBadge] = useState(false);\n    const dropdownRef = useRef<HTMLDivElement>(null);\n\n    const { socket } = useSocket();\n\n    useEffect(() => {\n        if (user) {\n            fetchData();\n        }\n    }, [user]);\n\n    useEffect(() => {\n        if (socket) {\n            socket.on('notification', (newNotification: Notification) => {\n                setNotifications(prev => [newNotification, ...prev]);\n                setUnreadCount(prev => prev + 1);\n                setAnimateBadge(true);\n                setTimeout(() => setAnimateBadge(false), 1000);\n            });\n\n            socket.on('friend_request', () => {\n                setRequestCount(prev => prev + 1);\n            });\n\n            return () => {\n                socket.off('notification');\n                socket.off('friend_request');\n            };\n        }\n    }, [socket]);\n\n    // Close dropdown when clicking outside\n    useEffect(() => {\n        function handleClickOutside(event: MouseEvent) {\n            if (dropdownRef.current && !dropdownRef.current.contains(event.target as Node)) {\n                setShowNotifications(false);\n            }\n        }\n        document.addEventListener(\"mousedown\", handleClickOutside);\n        return () => document.removeEventListener(\"mousedown\", handleClickOutside);\n    }, []);\n\n    const fetchData = async () => {\n        try {\n            const [requestsRes, notifRes] = await Promise.all([\n                api.get('/users/friend-requests'),\n                api.get('/notifications')\n            ]);\n            setRequestCount(requestsRes.data.length);\n\n            const newUnreadCount = notifRes.data.unreadCount;\n            if (newUnreadCount > unreadCount) {\n                setAnimateBadge(true);\n                setTimeout(() => setAnimateBadge(false), 1000); // Reset animation\n            }\n            setUnreadCount(newUnreadCount);\n            setNotifications(notifRes.data.notifications);\n        } catch (err) {\n            console.error(err);\n        }\n    };\n\n    const handleNotificationClick = () => {\n        setShowNotifications(!showNotifications);\n    };\n\n    const handleMarkAllRead = async () => {\n        try {\n            await api.put('/notifications/read');\n            setUnreadCount(0);\n            setNotifications([]);\n        } catch (err) {\n            console.error(err);\n        }\n    };\n\n    const handleSingleRead = async (id: string, isRead: boolean) => {\n        setShowNotifications(false);\n        if (!isRead) {\n            try {\n                await api.put(`/notifications/${id}/read`);\n                setUnreadCount(prev => Math.max(0, prev - 1));\n                setNotifications(prev => prev.filter(n => n._id !== id));\n            } catch (err) {\n                console.error(err);\n            }\n        }\n    };\n\n    const [isMenuOpen, setIsMenuOpen] = useState(false);\n\n    return (\n        <nav className=\"bg-orange-600 text-white p-4 shadow-md relative z-50\">\n            <div className=\"container mx-auto flex justify-between items-center\">\n                <Link href=\"/dashboard\" className=\"text-xl font-bold flex items-center gap-2\">\n                    <img src=\"/logo.png\" alt=\"Logo\" className=\"w-8 h-8\" />\n                    <span className=\"hidden sm:inline\">StravaClone</span>\n                </Link>\n\n                <div className=\"flex items-center gap-2 sm:gap-6\">\n                    {user ? (\n                        <>\n                            {/* Chat Icon - Always Visible */}\n                            <button\n                                onClick={toggleChat}\n                                className=\"relative hover:text-orange-200 flex items-center p-2\"\n                            >\n                                <MessageCircle size={24} />\n                                {chatUnreadCount > 0 && (\n                                    <span className=\"absolute top-0 right-0 bg-red-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center border-2 border-orange-600\">\n                                        {chatUnreadCount}\n                                    </span>\n                                )}\n                            </button>\n\n                            {/* Notifications - Always Visible */}\n                            <div className=\"relative\" ref={dropdownRef}>\n                                <button\n                                    onClick={handleNotificationClick}\n                                    className=\"relative hover:text-orange-200 flex items-center p-2\"\n                                >\n                                    <Bell size={24} />\n                                    {unreadCount > 0 && (\n                                        <span className={`absolute top-0 right-0 bg-red-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center border-2 border-orange-600 ${animateBadge ? 'animate-bounce' : ''}`}>\n                                            {unreadCount}\n                                        </span>\n                                    )}\n                                </button>\n\n                                {showNotifications && (\n                                    <div className=\"absolute right-[-60px] sm:right-0 mt-2 w-80 bg-white text-gray-800 rounded-lg shadow-xl border border-gray-200 overflow-hidden z-[100]\">\n                                        <div className=\"p-3 border-b bg-gray-50 font-semibold flex justify-between items-center\">\n                                            <span>Notifications</span>\n                                            {unreadCount > 0 && (\n                                                <button\n                                                    onClick={handleMarkAllRead}\n                                                    className=\"text-xs text-orange-600 hover:text-orange-800 font-normal\"\n                                                >\n                                                    Mark all read\n                                                </button>\n                                            )}\n                                        </div>\n                                        <div className=\"max-h-96 overflow-y-auto\">\n                                            {notifications.length === 0 ? (\n                                                <div className=\"p-4 text-center text-gray-500 text-sm\">No notifications</div>\n                                            ) : (\n                                                notifications.map(notif => (\n                                                    <div\n                                                        key={notif._id}\n                                                        className={`block p-3 hover:bg-gray-50 border-b last:border-b-0 text-sm ${!notif.read ? 'bg-orange-50 border-l-4 border-l-orange-500' : ''}`}\n                                                    >\n                                                        <div className=\"flex flex-col gap-1\">\n                                                            <div className=\"flex justify-between items-start\">\n                                                                <Link\n                                                                    href={`/profile/${notif.sender._id}`}\n                                                                    className=\"font-semibold hover:underline hover:text-orange-600\"\n                                                                    onClick={(e) => {\n                                                                        e.stopPropagation();\n                                                                        setShowNotifications(false);\n                                                                    }}\n                                                                >\n                                                                    {notif.sender.username}\n                                                                </Link>\n                                                                <span className=\"text-gray-400 text-xs\">\n                                                                    {/* Time optional */}\n                                                                </span>\n                                                            </div>\n                                                            <Link\n                                                                href={`/activity/${notif.activity?._id}`}\n                                                                className=\"hover:underline text-gray-600\"\n                                                                onClick={() => handleSingleRead(notif._id, notif.read)}\n                                                            >\n                                                                {notif.type === 'like' ? 'liked' : (notif.type === 'comment' ? 'commented on' : 'replied to')}\n                                                                {' '}\n                                                                <span className=\"font-medium text-orange-600\">{notif.activity?.title || 'an activity'}</span>\n                                                            </Link>\n                                                        </div>\n                                                    </div>\n                                                ))\n                                            )}\n                                        </div>\n                                    </div>\n                                )}\n                            </div>\n\n                            {/* Desktop Navigation */}\n                            <div className=\"hidden md:flex items-center gap-6\">\n                                <Link href=\"/search\" className=\"hover:text-orange-200\">Find Friends</Link>\n                                <Link href=\"/friends\" className=\"hover:text-orange-200 relative\">\n                                    Requests\n                                    {requestCount > 0 && (\n                                        <span className=\"absolute -top-2 -right-3 bg-red-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center\">\n                                            {requestCount}\n                                        </span>\n                                    )}\n                                </Link>\n\n                                <Link href={`/profile/${user._id}`} className=\"flex items-center gap-2 hover:text-orange-200\">\n                                    <User size={20} />\n                                    <span>{user.username}</span>\n                                </Link>\n                                <button onClick={logout} className=\"flex items-center gap-1 hover:text-orange-200\">\n                                    <LogOut size={20} /> Logout\n                                </button>\n                            </div>\n\n                            {/* Mobile Hamburger Menu */}\n                            <button\n                                className=\"md:hidden p-2\"\n                                onClick={() => setIsMenuOpen(!isMenuOpen)}\n                            >\n                                <div className=\"space-y-1.5 cursor-pointer\">\n                                    <div className={`w-6 h-0.5 bg-white transition-all ${isMenuOpen ? 'rotate-45 translate-y-2' : ''}`}></div>\n                                    <div className={`w-6 h-0.5 bg-white transition-opacity ${isMenuOpen ? 'opacity-0' : ''}`}></div>\n                                    <div className={`w-6 h-0.5 bg-white transition-all ${isMenuOpen ? '-rotate-45 -translate-y-2' : ''}`}></div>\n                                </div>\n                            </button>\n                        </>\n                    ) : (\n                        <Link href=\"/login\" className=\"hover:text-orange-200 font-semibold\">Login</Link>\n                    )}\n                </div>\n            </div>\n\n            {/* Mobile Dropdown Menu */}\n            {isMenuOpen && user && (\n                <div className=\"md:hidden absolute top-full left-0 w-full bg-orange-700 shadow-lg border-t border-orange-500 flex flex-col p-4 space-y-4 animate-in slide-in-from-top-2\">\n                    <Link\n                        href={`/profile/${user._id}`}\n                        className=\"flex items-center gap-3 hover:bg-orange-600 p-2 rounded transition-colors\"\n                        onClick={() => setIsMenuOpen(false)}\n                    >\n                        <User size={20} />\n                        <span className=\"font-semibold\">{user.username}</span>\n                    </Link>\n                    <Link\n                        href=\"/search\"\n                        className=\"flex items-center gap-3 hover:bg-orange-600 p-2 rounded transition-colors\"\n                        onClick={() => setIsMenuOpen(false)}\n                    >\n                        <span className=\"w-5 text-center\">üîç</span>\n                        <span>Find Friends</span>\n                    </Link>\n                    <Link\n                        href=\"/friends\"\n                        className=\"flex items-center gap-3 hover:bg-orange-600 p-2 rounded transition-colors justify-between\"\n                        onClick={() => setIsMenuOpen(false)}\n                    >\n                        <div className=\"flex items-center gap-3\">\n                            <span className=\"w-5 text-center\">üë•</span>\n                            <span>Requests</span>\n                        </div>\n                        {requestCount > 0 && (\n                            <span className=\"bg-red-500 text-white text-xs rounded-full px-2 py-1\">\n                                {requestCount} New\n                            </span>\n                        )}\n                    </Link>\n                    <hr className=\"border-orange-500\" />\n                    <button\n                        onClick={() => {\n                            logout();\n                            setIsMenuOpen(false);\n                        }}\n                        className=\"flex items-center gap-3 hover:bg-red-600 p-2 rounded transition-colors text-left\"\n                    >\n                        <LogOut size={20} />\n                        <span>Logout</span>\n                    </button>\n                </div>\n            )}\n\n            {/* Floating Upload Button - Responsive Position */}\n            {user && pathname !== '/upload' && (\n                <Link\n                    href=\"/upload\"\n                    className=\"fixed bottom-6 right-6 md:bottom-8 md:left-1/2 md:transform md:-translate-x-1/2 bg-orange-600 text-white w-14 h-14 md:w-auto md:h-auto md:px-4 md:py-2 rounded-full shadow-lg hover:bg-orange-700 transition-colors z-40 flex items-center justify-center gap-2\"\n                >\n                    <Upload size={24} />\n                    <span className=\"hidden md:inline font-bold text-sm tracking-wide\">Upload Activity</span>\n                </Link>\n            )}\n\n            <ChatWidget />\n        </nav>\n    );\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1354, "column": 0}, "map": {"version":3,"sources":["file:///home/lorenzo/Documents/Projects/strava-clone/client/src/components/CommentsSection.tsx"],"sourcesContent":["import { useState, useEffect } from 'react';\nimport api from '@/utils/api';\nimport { useAuth } from '@/context/AuthContext';\nimport { useSocket } from '@/context/SocketContext';\nimport Link from 'next/link';\n\ninterface Comment {\n    _id: string;\n    user: {\n        _id: string;\n        username: string;\n        profilePicture?: string;\n    };\n    text: string;\n    createdAt: string;\n    parentComment?: string | null;\n}\n\ninterface CommentsSectionProps {\n    activityId: string;\n}\n\nexport default function CommentsSection({ activityId }: CommentsSectionProps) {\n    const [comments, setComments] = useState<Comment[]>([]);\n    const [newComment, setNewComment] = useState('');\n    const [replyText, setReplyText] = useState<{ [key: string]: string }>({});\n    const [replyingTo, setReplyingTo] = useState<string | null>(null);\n    const [showAddComment, setShowAddComment] = useState(false);\n    const [loading, setLoading] = useState(true);\n    const [page, setPage] = useState(1);\n    const [totalPages, setTotalPages] = useState(1);\n    const { user } = useAuth();\n    const { socket } = useSocket(); // Added useSocket hook\n\n    useEffect(() => {\n        fetchComments(); // Removed '1' argument\n    }, [activityId]);\n\n    // New useEffect for socket events\n    useEffect(() => {\n        if (socket && activityId) {\n            socket.on(`activity_${activityId}_comments`, (newComment: Comment) => {\n                // Add the new comment (whether root or reply) to the beginning of the comments array.\n                // The existing rendering logic (rootComments, getReplies) will correctly place it.\n                setComments(prev => {\n                    if (prev.some(c => c._id === newComment._id)) {\n                        return prev;\n                    }\n                    return [newComment, ...prev];\n                });\n            });\n\n            return () => {\n                socket.off(`activity_${activityId}_comments`);\n            };\n        }\n    }, [socket, activityId]);\n\n    const fetchComments = async (pageNum: number = 1) => { // Added default value for pageNum\n        try {\n            const { data } = await api.get(`/activities/${activityId}/comments?page=${pageNum}&limit=10`);\n            if (pageNum === 1) {\n                setComments(data.comments);\n            } else {\n                setComments(prev => [...prev, ...data.comments]);\n            }\n            setTotalPages(data.totalPages);\n            setPage(pageNum);\n        } catch (error) {\n            console.error('Error fetching comments:', error);\n        } finally {\n            setLoading(false);\n        }\n    };\n\n    const loadMore = () => {\n        if (page < totalPages) {\n            fetchComments(page + 1);\n        }\n    };\n\n    const handleSubmit = async (e: React.FormEvent, parentId: string | null = null) => {\n        e.preventDefault();\n        const text = parentId ? replyText[parentId] : newComment;\n\n        if (!text || !text.trim()) return;\n\n        try {\n            const { data } = await api.post(`/activities/${activityId}/comments`, {\n                text,\n                parentComment: parentId\n            });\n\n            setComments(prev => {\n                if (prev.some(c => c._id === data._id)) {\n                    return prev;\n                }\n                return [data, ...prev];\n            });\n\n            if (parentId) {\n                setReplyText({ ...replyText, [parentId]: '' });\n                setReplyingTo(null);\n            } else {\n                setNewComment('');\n                setShowAddComment(false);\n            }\n        } catch (error) {\n            console.error('Error adding comment:', error);\n        }\n    };\n\n    const formatDate = (dateString: string) => {\n        const date = new Date(dateString);\n        return date.toLocaleString([], {\n            year: 'numeric',\n            month: 'numeric',\n            day: 'numeric',\n            hour: '2-digit',\n            minute: '2-digit'\n        });\n    };\n\n    // Organize comments into threads\n    const rootComments = comments.filter(c => !c.parentComment);\n    const getReplies = (parentId: string) => comments.filter(c => c.parentComment === parentId).sort((a, b) => new Date(a.createdAt).getTime() - new Date(b.createdAt).getTime());\n\n    if (loading && page === 1) return <div className=\"mt-6 text-gray-500\">Loading comments...</div>;\n\n    return (\n        <div className=\"mt-8 border-t pt-6\">\n            <div className=\"flex items-center justify-between mb-4\">\n                <h2 className=\"text-xl font-bold\">Comments</h2>\n                {user && comments.length > 0 && !showAddComment && (\n                    <button\n                        onClick={() => setShowAddComment(true)}\n                        className=\"text-orange-500 hover:text-orange-600 font-medium\"\n                    >\n                        Add Comment\n                    </button>\n                )}\n            </div>\n\n            {user && showAddComment && (\n                <form onSubmit={(e) => handleSubmit(e)} className=\"mb-6\">\n                    <textarea\n                        className=\"w-full border rounded p-3 focus:outline-none focus:ring-2 focus:ring-orange-500\"\n                        placeholder=\"Add a comment...\"\n                        rows={3}\n                        value={newComment}\n                        onChange={(e) => setNewComment(e.target.value)}\n                    />\n                    <div className=\"flex justify-end gap-2 mt-2\">\n                        {comments.length > 0 && (\n                            <button\n                                type=\"button\"\n                                onClick={() => setShowAddComment(false)}\n                                className=\"px-4 py-2 text-gray-500 hover:text-gray-700\"\n                            >\n                                Cancel\n                            </button>\n                        )}\n                        <button\n                            type=\"submit\"\n                            className=\"bg-orange-500 text-white px-4 py-2 rounded hover:bg-orange-600 transition-colors\"\n                            disabled={!newComment.trim()}\n                        >\n                            Post Comment\n                        </button>\n                    </div>\n                </form>\n            )}\n\n            <div className=\"space-y-6\">\n                {rootComments.length === 0 && !showAddComment ? (\n                    <div className=\"text-center py-4\">\n                        <p className=\"text-gray-500 mb-2\">No comments yet.</p>\n                        {user && (\n                            <button\n                                onClick={() => setShowAddComment(true)}\n                                className=\"text-orange-500 font-medium\"\n                            >\n                                Be the first to share your thoughts!\n                            </button>\n                        )}\n                    </div>\n                ) : (\n                    <>\n                        {rootComments.map((comment) => (\n                            <div key={comment._id} className=\"bg-gray-50 p-4 rounded-lg\">\n                                {/* Comment Header */}\n                                <div className=\"flex items-center justify-between mb-2\">\n                                    <div className=\"flex items-center gap-2\">\n                                        <Link href={`/profile/${comment.user._id}`} className=\"font-semibold text-gray-800 hover:text-orange-600 hover:underline\">\n                                            {comment.user.username}\n                                        </Link>\n                                        <span className=\"text-xs text-gray-500\">\n                                            {formatDate(comment.createdAt)}\n                                        </span>\n                                    </div>\n                                </div>\n\n                                {/* Comment Body */}\n                                <p className=\"text-gray-700 mb-3\">{comment.text}</p>\n\n                                {/* Reply Button */}\n                                {user && (\n                                    <button\n                                        onClick={() => setReplyingTo(replyingTo === comment._id ? null : comment._id)}\n                                        className=\"text-sm text-gray-500 hover:text-orange-500 font-medium mb-2\"\n                                    >\n                                        Reply\n                                    </button>\n                                )}\n\n                                {/* Reply Form */}\n                                {replyingTo === comment._id && (\n                                    <form onSubmit={(e) => handleSubmit(e, comment._id)} className=\"mt-2 mb-4 ml-4\">\n                                        <textarea\n                                            className=\"w-full border rounded p-2 text-sm focus:outline-none focus:ring-1 focus:ring-orange-500\"\n                                            placeholder={`Reply to ${comment.user.username}...`}\n                                            rows={2}\n                                            value={replyText[comment._id] || ''}\n                                            onChange={(e) => setReplyText({ ...replyText, [comment._id]: e.target.value })}\n                                        />\n                                        <div className=\"flex justify-end gap-2 mt-1\">\n                                            <button\n                                                type=\"button\"\n                                                onClick={() => setReplyingTo(null)}\n                                                className=\"text-xs text-gray-500 hover:text-gray-700\"\n                                            >\n                                                Cancel\n                                            </button>\n                                            <button\n                                                type=\"submit\"\n                                                className=\"bg-orange-500 text-white px-3 py-1 text-xs rounded hover:bg-orange-600\"\n                                                disabled={!replyText[comment._id]?.trim()}\n                                            >\n                                                Reply\n                                            </button>\n                                        </div>\n                                    </form>\n                                )}\n\n                                {/* Replies List */}\n                                {getReplies(comment._id).length > 0 && (\n                                    <div className=\"ml-6 mt-3 space-y-3 border-l-2 border-gray-200 pl-4\">\n                                        {getReplies(comment._id).map((reply) => (\n                                            <div key={reply._id}>\n                                                <div className=\"flex items-center gap-2 mb-1\">\n                                                    <Link href={`/profile/${reply.user._id}`} className=\"font-semibold text-sm text-gray-800 hover:text-orange-600 hover:underline\">\n                                                        {reply.user.username}\n                                                    </Link>\n                                                    <span className=\"text-xs text-gray-500\">\n                                                        {formatDate(reply.createdAt)}\n                                                    </span>\n                                                </div>\n                                                <p className=\"text-sm text-gray-700\">{reply.text}</p>\n                                            </div>\n                                        ))}\n                                    </div>\n                                )}\n                            </div>\n                        ))}\n\n                        {page < totalPages && (\n                            <div className=\"flex justify-center mt-4\">\n                                <button\n                                    onClick={loadMore}\n                                    className=\"flex items-center gap-1 text-orange-500 hover:text-orange-600 font-medium transition-colors\"\n                                >\n                                    <span>Load more comments</span>\n                                    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\">\n                                        <path d=\"m6 9 6 6 6-6\" />\n                                    </svg>\n                                </button>\n                            </div>\n                        )}\n                    </>\n                )}\n            </div>\n        </div>\n    );\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1820, "column": 0}, "map": {"version":3,"sources":["file:///home/lorenzo/Documents/Projects/strava-clone/client/src/app/activity/%5Bid%5D/page.tsx"],"sourcesContent":["'use client';\n\nimport { useEffect, useState } from 'react';\nimport api from '@/utils/api';\nimport Navbar from '@/components/Navbar';\nimport dynamic from 'next/dynamic';\nimport { useParams, useRouter } from 'next/navigation';\nimport { Heart } from 'lucide-react';\nimport { useAuth } from '@/context/AuthContext';\nimport { useSocket } from '@/context/SocketContext';\n\n// Dynamically import Map to avoid SSR issues\nconst Map = dynamic(() => import('@/components/Map'), { ssr: false });\nimport CommentsSection from '@/components/CommentsSection';\n\ninterface Activity {\n    _id: string;\n    title: string;\n    description: string;\n    sportType: string;\n    location: {\n        coordinates: [number, number, number][]; // [lng, lat, ele]\n    };\n    stats: {\n        distance: number;\n        duration: number;\n        elevationGain: number;\n    };\n    user: {\n        username: string;\n    };\n    likes: string[];\n}\n\nexport default function ActivityPage() {\n    const { id } = useParams();\n    const { user, loading: authLoading } = useAuth();\n    const router = useRouter();\n    const [activity, setActivity] = useState<Activity | null>(null);\n    const [loading, setLoading] = useState(true);\n    const [isLiked, setIsLiked] = useState(false);\n    const [likeCount, setLikeCount] = useState(0);\n\n    const { socket } = useSocket();\n\n    useEffect(() => {\n        if (!authLoading && !user) {\n            router.push('/login');\n            return;\n        }\n\n        const fetchActivity = async () => {\n            if (authLoading || !user) return;\n\n            try {\n                const { data } = await api.get(`/activities/${id}`);\n                setActivity(data);\n                setLikeCount(data.likes.length);\n                setIsLiked(data.likes.includes(user._id));\n            } catch (error) {\n                console.error('Error fetching activity:', error);\n            } finally {\n                setLoading(false);\n            }\n        };\n\n        if (id) fetchActivity();\n    }, [id, user, authLoading, router]);\n\n    useEffect(() => {\n        if (socket && id) {\n            socket.on(`activity_${id}_likes`, (data: { count: number, likes: string[] }) => {\n                setLikeCount(data.count);\n                if (user) {\n                    setIsLiked(data.likes.includes(user._id));\n                }\n            });\n\n            return () => {\n                socket.off(`activity_${id}_likes`);\n            };\n        }\n    }, [socket, id, user]);\n\n    const handleToggleLike = async () => {\n        if (!activity) return;\n        try {\n            const { data } = await api.post(`/likes/${activity._id}`);\n            setIsLiked(data.liked);\n        } catch (error) {\n            console.error('Error toggling like:', error);\n        }\n    };\n\n    if (loading) return <div>Loading...</div>;\n    if (!activity) return <div>Activity not found</div>;\n\n    // Convert GeoJSON [lng, lat] to Leaflet [lat, lng]\n    const mapCoordinates = activity.location.coordinates.map(coord => [coord[1], coord[0]] as [number, number]);\n\n    return (\n        <div className=\"min-h-screen bg-gray-100 pb-32\">\n            <Navbar />\n            <div className=\"container mx-auto p-4 max-w-4xl\">\n                <div className=\"bg-white p-6 rounded-lg shadow-md mt-6\">\n                    <h1 className=\"text-3xl font-bold mb-2\">{activity.title}</h1>\n                    <p className=\"text-gray-600 mb-4\">{activity.description}</p>\n\n                    <div className=\"grid grid-cols-3 gap-4 mb-6 text-center\">\n                        <div className=\"bg-gray-50 p-4 rounded\">\n                            <p className=\"text-gray-500 text-sm\">Distance</p>\n                            <p className=\"text-xl font-bold\">{(activity.stats.distance / 1000).toFixed(2)} km</p>\n                        </div>\n                        <div className=\"bg-gray-50 p-4 rounded\">\n                            <p className=\"text-gray-500 text-sm\">Duration</p>\n                            <p className=\"text-xl font-bold\">{Math.floor(activity.stats.duration / 60)} min</p>\n                        </div>\n                        <div className=\"bg-gray-50 p-4 rounded\">\n                            <p className=\"text-gray-500 text-sm\">Elevation</p>\n                            <p className=\"text-xl font-bold\">{activity.stats.elevationGain} m</p>\n                        </div>\n                    </div>\n\n                    <div className=\"rounded-lg overflow-hidden border mb-4\">\n                        <Map coordinates={mapCoordinates} />\n                    </div>\n\n                    {/* Likes Section */}\n                    <div className=\"flex items-center gap-2 mb-6\">\n                        <button\n                            onClick={handleToggleLike}\n                            className={`flex items-center gap-2 transition-colors ${isLiked ? 'text-red-500' : 'text-gray-500 hover:text-red-500'}`}\n                        >\n                            <Heart size={28} fill={isLiked ? \"currentColor\" : \"none\"} />\n                        </button>\n                        <span className=\"text-lg font-semibold\">{likeCount} likes</span>\n                    </div>\n\n                    <CommentsSection activityId={activity._id} />\n                </div>\n            </div>\n        </div>\n    );\n}\n"],"names":[],"mappings":"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"}}]
}